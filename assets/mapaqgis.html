<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="./resources/ol.css">
        <link rel="stylesheet" href="resources/fontawesome-all.min.css">
        <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
        <link rel="stylesheet" href="./resources/qgis2web.css">
        <style>
        html, body {
            background-color: #ffffff;
        }
        .ol-control > * {
            background-color: #f8f8f8!important;
            color: #444444!important;
            border-radius: 0px;
        }
        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #444444!important;
        }
        .search-layer-input-search {
            background-color: #f8f8f8!important;
        }
        .ol-control > *:focus, .ol-control >*:hover {
            background-color: rgba(248, 248, 248, 0.7)!important;
        } 
        .ol-control {
            background-color: rgba(255,255,255,.4) !important;
            padding: 2px !important;
        } 
        #map 
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #search-input {
                position: absolute;
                top: 8px;
                left: 50px;
                z-index: 100;
                padding: 5px;
                width: 300px;
                border: 1px solid #ccc;
                border-radius: 3px;
            }
        </style>
        <title>Mapa con Búsqueda</title>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3qo14pV7NI4PfsfsjTTPwnAHqzNE9M2A&libraries=places"></script>
    </head>
    <body>
        <div id="map">
            <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
            </div>
        </div>
        <script src="resources/qgis2web_expressions.js"></script>
        <script src="./resources/functions.js"></script>
        <script src="./resources/ol.js"></script>
        <script src="./resources/ol-layerswitcher.js"></script>
        <script src="resources/ol-geocoder.js"></script>
        <script src="layers/CorredorSanMartn__1.js"></script>
        <script src="layers/CorredorSanMartncorredor_san_martn__2.js"></script>
        <script src="layers/CorredorSantaFeeste_3.js"></script>
        <script src="layers/CorredorSantaFecorredor_santa_fe_este_4.js"></script>
        <script src="layers/CorredorEntreRios__5.js"></script>
        <script src="layers/CorredorEntreRioscorredor_entre_ros__6.js"></script>
        <script src="layers/CorredorSarmientosurestesuroeste_7.js"></script>
        <script src="layers/CorredorSarmientocorredor_sarmiento__8.js"></script>
        <script src="layers/CorredorVelezSarsfieldnorte_9.js"></script>
        <script src="layers/CorredorVelezSarsfieldcorredor_vlez_sarsfield_norte_10.js"></script>
        <script src="layers/CorredorFernandezdelaCruznoreste_11.js"></script>
        <script src="layers/CorredorFernandezdelaCruzcorredor_av_fernndez_de_la_cruz_noreste_12.js"></script>
        <script src="layers/CorredorFigueroaAlcortanoroeste_13.js"></script>
        <script src="layers/CorredorFigueroaAlcortacorredor_figueroa_alcorta_noroeste_14.js"></script>
        <script src="layers/CorredorIndependencia__15.js"></script>
        <script src="layers/CorredorIndependenciacorredor_independencia_16.js"></script>
        <script src="layers/CLVAislados__17.js"></script>
        <script src="layers/CLVAisladosclv_aislados_18.js"></script>
        <script src="layers/CorredorJuanBJusto__19.js"></script>
        <script src="layers/CorredorJuanBJustocorredor_juan_b_justo_20.js"></script>
        <script src="layers/Corredor9deJulio__21.js"></script>
        <script src="layers/Corredor9deJuliocorredor_9_de_julio_22.js"></script>
        <script src="layers/CorredorLibertador__23.js"></script>
        <script src="layers/CorredorLibertadorcorredor_libertador_24.js"></script>
        <script src="layers/CorredorBelgrano__25.js"></script>
        <script src="layers/CorredorBelgranocorredor_belgrano__26.js"></script>
        <script src="layers/CorredorMontesdeOca__27.js"></script>
        <script src="layers/CorredorMontesdeOcacorredor_montes_de_oca_28.js"></script>
        <script src="layers/CorredorCabildosureste_29.js"></script>
        <script src="layers/CorredorCabildocorredor_cabildo_sureste_30.js"></script>
        <script src="layers/CorredorCordoba__31.js"></script>
        <script src="layers/CorredorCordobacorredor_crdoba_32.js"></script>
        <script src="layers/CorredorPueyrredonsur_33.js"></script>
        <script src="layers/CorredorPueyrredoncorredor_pueyrredn_sur_34.js"></script>
        <script src="layers/CorredorSanJuan__35.js"></script>
        <script src="layers/CorredorSanJuancorredor_san_juan_36.js"></script>
        <script src="layers/CorredorCorrientes_37.js"></script>
        <script src="layers/CorredorCorrientescorredor_corrientes_38.js"></script>
        <script src="layers/Lugarespedidos_39.js"></script>
        <script src="layers/eventos_geojson_40.js"></script>
        <script src="styles/CorredorSanMartn__1_style.js"></script>
        <script src="styles/CorredorSanMartncorredor_san_martn__2_style.js"></script>
        <script src="styles/CorredorSantaFeeste_3_style.js"></script>
        <script src="styles/CorredorSantaFecorredor_santa_fe_este_4_style.js"></script>
        <script src="styles/CorredorEntreRios__5_style.js"></script>
        <script src="styles/CorredorEntreRioscorredor_entre_ros__6_style.js"></script>
        <script src="styles/CorredorSarmientosurestesuroeste_7_style.js"></script>
        <script src="styles/CorredorSarmientocorredor_sarmiento__8_style.js"></script>
        <script src="styles/CorredorVelezSarsfieldnorte_9_style.js"></script>
        <script src="styles/CorredorVelezSarsfieldcorredor_vlez_sarsfield_norte_10_style.js"></script>
        <script src="styles/CorredorFernandezdelaCruznoreste_11_style.js"></script>
        <script src="styles/CorredorFernandezdelaCruzcorredor_av_fernndez_de_la_cruz_noreste_12_style.js"></script>
        <script src="styles/CorredorFigueroaAlcortanoroeste_13_style.js"></script>
        <script src="styles/CorredorFigueroaAlcortacorredor_figueroa_alcorta_noroeste_14_style.js"></script>
        <script src="styles/CorredorIndependencia__15_style.js"></script>
        <script src="styles/CorredorIndependenciacorredor_independencia_16_style.js"></script>
        <script src="styles/CLVAislados__17_style.js"></script>
        <script src="styles/CLVAisladosclv_aislados_18_style.js"></script>
        <script src="styles/CorredorJuanBJusto__19_style.js"></script>
        <script src="styles/CorredorJuanBJustocorredor_juan_b_justo_20_style.js"></script>
        <script src="styles/Corredor9deJulio__21_style.js"></script>
        <script src="styles/Corredor9deJuliocorredor_9_de_julio_22_style.js"></script>
        <script src="styles/CorredorLibertador__23_style.js"></script>
        <script src="styles/CorredorLibertadorcorredor_libertador_24_style.js"></script>
        <script src="styles/CorredorBelgrano__25_style.js"></script>
        <script src="styles/CorredorBelgranocorredor_belgrano__26_style.js"></script>
        <script src="styles/CorredorMontesdeOca__27_style.js"></script>
        <script src="styles/CorredorMontesdeOcacorredor_montes_de_oca_28_style.js"></script>
        <script src="styles/CorredorCabildosureste_29_style.js"></script>
        <script src="styles/CorredorCabildocorredor_cabildo_sureste_30_style.js"></script>
        <script src="styles/CorredorCordoba__31_style.js"></script>
        <script src="styles/CorredorCordobacorredor_crdoba_32_style.js"></script>
        <script src="styles/CorredorPueyrredonsur_33_style.js"></script>
        <script src="styles/CorredorPueyrredoncorredor_pueyrredn_sur_34_style.js"></script>
        <script src="styles/CorredorSanJuan__35_style.js"></script>
        <script src="styles/CorredorSanJuancorredor_san_juan_36_style.js"></script>
        <script src="styles/CorredorCorrientes_37_style.js"></script>
        <script src="styles/CorredorCorrientescorredor_corrientes_38_style.js"></script>
        <script src="styles/Lugarespedidos_39_style.js"></script>
        <script src="styles/eventos_geojson_40_style.js"></script>
        <script src="./layers/layers.js" type="text/javascript"></script> 
        <script src="./resources/Autolinker.min.js"></script>
        <script src="./resources/qgis2web.js"></script>
    
        <input type="text" id="search-input" placeholder="Buscar en CABA...">
        
        <script>
    
            // Crear una capa para almacenar el marcador
            var vectorSource = new ol.source.Vector({});
            var vectorLayer = new ol.layer.Vector({
                source: vectorSource
            });
            map.addLayer(vectorLayer); // Agregar la capa de marcador al mapa
    
            // Función para actualizar los eventos de GeoJSON
            function updateEventosGeoJSON() {
                fetch('resources/eventos_geojson.json')  // Assumes the file is in 'resources'
                .then(response => response.json())
                .then(data => {
                    if (lyr_eventos_geojson_40) {
                        lyr_eventos_geojson_40.getSource().clear(); // Clear existing features
                    }
    
                    var format = new ol.format.GeoJSON();
                    var features = format.readFeatures(data, {
                        dataProjection: 'EPSG:4326',
                        featureProjection: 'EPSG:3857'
                    });
    
                    if (!lyr_eventos_geojson_40) {
                        lyr_eventos_geojson_40 = new ol.layer.Vector({
                            source: new ol.source.Vector({
                                features: features
                            }),
                            style: style_eventos_geojson_40, // Ensure style is defined
                            title: "eventos_geojson"
                        });
                        map.addLayer(lyr_eventos_geojson_40); // Add layer if it's not already added
                    } else {
                        lyr_eventos_geojson_40.getSource().addFeatures(features);
                    }
                })
                .catch(error => console.error("Error loading GeoJSON:", error)); 
            }
    
            updateEventosGeoJSON(); // Initial load
            setInterval(updateEventosGeoJSON, 60000); // Update every minute (60000 milliseconds)
    
            // Crear una capa para almacenar el marcador
            var vectorSource = new ol.source.Vector({});
            var vectorLayer = new ol.layer.Vector({
                source: vectorSource
            });
            map.addLayer(vectorLayer); // Agregar la capa de marcador al mapa

            // Función para inicializar la barra de búsqueda
            function initAutocomplete() {
                const input = document.getElementById("search-input");
                const autocomplete = new google.maps.places.Autocomplete(input, {
                    bounds: {
                        north: -34.528227,
                        south: -34.727747,
                        east: -58.352678,
                        west: -58.529213
                    },
                    strictBounds: true,
                    types: ['geocode'] // Solo lugares geográficos
                });

                autocomplete.addListener("place_changed", function () {
                    const place = autocomplete.getPlace();
                    if (place.geometry && place.geometry.location) {
                        const coord = ol.proj.fromLonLat([place.geometry.location.lng(), place.geometry.location.lat()]);

                        // Centrar el mapa en la nueva ubicación
                        map.getView().animate({ center: coord, zoom: 15 });

                        // Limpiar el marcador anterior
                        vectorSource.clear();

                        // Crear un nuevo marcador en la nueva ubicación seleccionada
                        var iconFeature = new ol.Feature({
                            geometry: new ol.geom.Point(coord),
                            name: place.name
                        });

                        // Crear un estilo para el marcador con tamaño fijo
                        var iconStyle = new ol.style.Style({
                            image: new ol.style.Icon({
                                src: './resources/icono.png', // Ruta local al ícono
                                scale: 0.05, // Escala fija para el ícono
                                anchor: [0.5, 1], // Ajusta el punto de anclaje
                                anchorXUnits: 'fraction',
                                anchorYUnits: 'fraction'
                            })
                        });

                        iconFeature.setStyle(iconStyle);

                        // Agregar el nuevo marcador al mapa
                        vectorSource.addFeature(iconFeature);
                    } else {
                        alert("No se encontró la ubicación.");
                    }
                });
            }

            // Llamar a la función de inicialización de la barra de búsqueda
            initAutocomplete();

            </script>
        </body>
    </html>