import sys
print("Python version:", sys.version)
try:
    import pandas as pd
    print("Pandas version:", pd.__version__)
except ImportError:
    print("Error: Pandas is not installed")
try:
    import plotly
    print("Plotly version:", plotly.__version__)
except ImportError:
    print("Error: Plotly is not installed")

import plotly.graph_objects as go
import sys
import os
import dash
import plotly.express as px
import plotly.graph_objects as go
import math
from dash import html, dcc
from dash.dependencies import Input, Output, State 
from fetch_waze_data import fetch_waze_data, process_waze_data
from datetime import datetime
from collections import defaultdict
import pytz
import pandas as pd



# Definimos la zona horaria de Buenos Aires

buenos_aires_tz = pytz.timezone('America/Argentina/Buenos_Aires')



# Diccionario de nombres de eventos

event_names = {

    'HAZARD_ON_ROAD_POT_HOLE': 'Baches en el camino',

    'ROAD_CLOSED_EVENT': 'Via cerrada',

    'HAZARD_ON_ROAD_CONSTRUCTION': 'Obras en la calzada',

    'JAM_HEAVY_TRAFFIC': 'Atasco tráfico pesado',

    'JAM_STAND_STILL_TRAFFIC': 'Atasco tráfico denso',

    'HAZARD_ON_SHOULDER_CAR_STOPPED': 'Vehículo detenido',

    'HAZARD_ON_ROAD': 'Peligro en calle',

    'HAZARD_ON_ROAD_TRAFFIC_LIGHT_FAULT': 'Falla de semáforo',

    'HAZARD_ON_ROAD_LANE_CLOSED': 'Carril cerrado',

    'HAZARD_ON_ROAD_OBJECT': 'Objeto en el camino',

    'ACCIDENT_MAJOR': 'Accidente grave'

}



# Inicializar la app de dash

app = dash.Dash(__name__)



app.index_string = '''

<!DOCTYPE html>

<html>

    <head>

        <meta charset="UTF-8">

        <title>Waze Dashboard</title>

        {%metas%}

        {%favicon%}

        {%css%}

    </head>

    <body>

        <div id="react-root">

            {%app_entry%}

        </div>

        {%config%}

        {%scripts%}

        {%renderer%}

        

        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2/build/vega.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.6.0/build/vega-lite.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.2"></script>



        <script>

            document.addEventListener('DOMContentLoaded', function() {

                const buttons = document.querySelectorAll('button[id^="alert-button"]');

                buttons.forEach(button => {

                    const buttonIndex = button.id.split('"index":')[1].split('}')[0];

                    if (localStorage.getItem(buttonIndex) === 'clicked') {

                        button.style.backgroundColor = 'lightblue';

                    }

                });

            });

        </script>



    </body>

</html>

'''



# Layout de la aplicación
app.layout = html.Div([
    # Sección del encabezado
    html.Div([
        html.Div([
            html.H1('EVENTOS DE WAZE', style={
                'textAlign': 'mid-center',
                'fontFamily': 'Calibri',
                'flex': '1',
                'margin': '0'
            }),
            html.Img(src='/assets/waze_logo.png', style={
                'height': '100px',
                'marginLeft': 'auto'
            })
        ], style={
            'display': 'flex',
            'alignItems': 'center',
            'width': '100%',
            'maxWidth': '1200px',
            'margin': '0 auto'
        }),
        dcc.Interval(
            id='interval-component',
            interval=5*60*1000,  # actualiza cada 5 minutos
            n_intervals=0
        ),
        html.Div(
            id='alerts-jams',
            style={'textAlign': 'center', 'border': '2px solid yellow', 'padding': '10px', 'margin': '10px 0'}
        ),
    ], style={'width': '100%', 'maxWidth': '1200px', 'margin': '0 auto'}),
    
    # Sección del mapa
    html.Div([
        html.Button(
            'CLV',
            id='toggle-clv-button',
            n_clicks=0,
            style={
                'margin': '10px',
                'padding': '10px 20px',
                'fontSize': '16px',
                'backgroundColor': '#4CAF50',
                'color': 'white',
                'border': 'none',
                'borderRadius': '5px',
                'cursor': 'pointer'
            }
        ),
        dcc.Graph(
            id='alerts-map',
            config={
                'scrollZoom': True,
                'displayModeBar': True,
                'modeBarButtonsToAdd': ['zoom', 'pan', 'select', 'lasso2d']
            },
            style={'height': '600px', 'width': '100%'}
        ),
        html.Div(id='legend-container', style={
            'position': 'absolute',
            'right': '10px',
            'top': '10px',
            'width': '200px',
            'backgroundColor': 'white',
            'border': '1px solid black',
            'padding': '10px'
        })
    ], style={'width': '100%', 'maxWidth': '1300px', 'margin': '0 auto'}),

    html.Div(id='map-and-legend-container'),  # Contenedor para el mapa y la leyenda
    
    # Sección de últimos eventos (ahora debajo del mapa)
    html.Div([
        html.H3('Últimos 15 Eventos', style={'textAlign': 'center'}),
        html.Div(id='recent-events', style={
            'overflowY': 'auto', 
            'maxHeight': '300px',
            'margin': '20px auto',
            'padding': '15px',
            'border': '1px solid #ddd',
            'borderRadius': '5px',
            'backgroundColor': '#f9f9f9'
        })
    ], style={'width': '100%', 'maxWidth': '1300px', 'margin': '20px auto'}),
    
    # Resto de las secciones
    html.Div([
        html.Div(id='event-details', style={'width': '100%'})
    ], style={'width': '100%', 'maxWidth': '1400px', 'margin': '0 auto'}),
    
    html.Div([
        dcc.Graph(id='alerts-by-type', style={'height': '400px'})
    ], style={'width': '100%', 'maxWidth': '1200px', 'margin': '20px auto'}),
    
    dcc.Store(id='processed-data-store'),
    dcc.Store(id='clicked-buttons', data=[]),
    dcc.Store(id='clv-visibility', data={'visible': False}),



    html.Script('''

        document.addEventListener('DOMContentLoaded', function() {

            const buttons = document.querySelectorAll('button[id^="alert-button"], button[id^="recent-event-button"]');

            buttons.forEach(button => {

                let buttonIndex;

                if (button.id.startsWith('{')) {

                    buttonIndex = button.id.split('"index":')[1].split('}')[0];

                } else {

                    buttonIndex = button.id.split('-')[2];

                    buttonIndex = 'recent-event-' + buttonIndex;

                }

                if (localStorage.getItem(buttonIndex) === 'clicked') {

                    button.style.backgroundColor = 'lightblue';

                }

            });

        });

    ''')



],  

 style={

    'fontFamily': 'Roboto, Calibri',

    'margin': '0 auto',

    'padding': '20px',

    'maxWidth': '1400px',

    'backgroundColor': '#e0e0e0'

})



# Función para actualizar las alertas por tipo

def update_alerts_by_type_figure(processed_data):

    alerts_by_subtype = processed_data['alerts_by_type']

    sorted_subtypes = sorted(alerts_by_subtype.items(), key=lambda x: x[1], reverse=False)

    subtypes, counts = zip(*sorted_subtypes) if sorted_subtypes else ([], [])

    fig = px.bar(

        x=counts,

        y=subtypes,

        orientation='h',

        title='Alertas por Subtipo'

    )

    fig.update_layout(

        clickmode='event+select'

    )

    return fig


@app.callback(
    [Output('alerts-jams', 'children'),
     #Output('alerts-map', 'figure'),
     Output('alerts-by-type', 'figure'),
     Output('event-details', 'children'),
     Output('recent-events', 'children'),
     Output('processed-data-store', 'data'),
     Output('clv-visibility', 'data')],
     #Output('legend-container', 'children'),
     Output('map-and-legend-container', 'children'),  # Nuevo output para actualizar el contenedor de leyendas
    [Input('toggle-clv-button', 'n_clicks'),
     Input('interval-component', 'n_intervals'),
     Input('alerts-map', 'clickData')],
    [State('processed-data-store', 'data'),
     State('clv-visibility', 'data')]
)
def update_dashboard_and_handle_interactions(n_clicks, n_intervals, clickData, data, clv_visibility):
    ctx = dash.callback_context
    triggered_id = ctx.triggered[0]['prop_id'].split('.')[0]

    if data is None:
        data = {}

    # Alternar visibilidad de CLV si se presionó el botón
    if triggered_id == 'toggle-clv-button':
        clv_visibility['visible'] = not clv_visibility['visible']

    # Procesar los datos
    api_url = "https://www.waze.com/row-partnerhub-api/partners/11517520851/waze-feeds/4004dedf-0b87-4eed-b3f6-e0ad22fa5238?format=1"
    raw_data = fetch_waze_data(api_url)
    raw_data['alerts'] = [alert for alert in raw_data.get('alerts', []) if alert.get('reportRating', 0) >= 4 and alert.get('reporter') != "Buenos_Aires"]
    processed_data = process_waze_data(raw_data)

    # Crear el mapa base con alertas
    df = pd.DataFrame(processed_data['alert_coordinates'])
    if not df.empty:
        center_lat = df['lat'].mean()
        center_lon = df['lon'].mean()
    else:
        center_lat, center_lon = -34.6037, -58.3816  # Coordenadas por defecto para Buenos Aires

    alert_map = px.scatter_mapbox(df, 
                                  lat="lat", 
                                  lon="lon", 
                                  color="evento",  
                                  hover_name="street",
                                  hover_data={"evento": True, "lat": False, "lon": False},
                                  labels={"evento": "Evento"},
                                  zoom=11,
                                  center=dict(lat=center_lat, lon=center_lon),
                                  title="Mapa de Alertas")
    alert_map.update_traces(marker=dict(size=15))
    
    
    # Definir los polígonos
    polygons = [
        {
            "coords": [(-58.4005901, -34.6236372), (-58.4002467, -34.6236239), (-58.3982418, -34.6233414),
                    (-58.3960742, -34.6230733), (-58.3912675, -34.6227825), (-58.3916376, -34.6226239),
                    (-58.3961812, -34.6229596), (-58.4003325, -34.6234518), (-58.4003862, -34.6228647),
                    (-58.4005606, -34.6218008), (-58.4005962, -34.6216496), (-58.4007727, -34.6203592),
                    (-58.4008892, -34.6184551), (-58.4012215, -34.614498), (-58.3919369, -34.6140167),
                    (-58.3919758, -34.6136943), (-58.401216, -34.6142857), (-58.4016049, -34.6100338),
                    (-58.4016753, -34.6096375), (-58.4020109, -34.6096248), (-58.4059123, -34.609954),
                    (-58.4058881, -34.6086943), (-58.4090182, -34.6089887), (-58.4089959, -34.6104248),
                    (-58.405728, -34.6102246), (-58.4019924, -34.6100359), (-58.4015646, -34.6142765),
                    (-58.4010387, -34.6185581), (-58.4021112, -34.6186361), (-58.4037768, -34.6188145),
                    (-58.4087519, -34.6197341), (-58.4126779, -34.6204761), (-58.416406, -34.620794),
                    (-58.4163575, -34.6211826), (-58.4124626, -34.6209179), (-58.408706, -34.6200709),
                    (-58.4036574, -34.6189788), (-58.401097, -34.6187538), (-58.4008741, -34.6206889),
                    (-58.4007765, -34.6218295), (-58.4007393, -34.6221369), (-58.4007021, -34.6223118),
                    (-58.4006706, -34.6227676), (-58.4005901, -34.6236372)],
            "name": "Área CLV Alberti (norte)",
            "color": "rgba(255, 0, 0, 0.2)",  # Color rojo con 20% de opacidad
            "line_color": "rgba(255, 0, 0, 0.3)"  # Contorno rojo con 30% de opacidad
        },
    
        {
            "coords": [(-58.3657846, -34.6185137), (-58.3655834, -34.6185822), (-58.3656504, -34.6176286),
                    (-58.3657416, -34.616749), (-58.3661963, -34.6123791), (-58.3661624, -34.6112777),
                    (-58.3662679, -34.6101365), (-58.3666859, -34.6054094), (-58.3673, -34.6005097),
                    (-58.3679873, -34.5981852), (-58.3700986, -34.5922183), (-58.3702397, -34.5915049),
                    (-58.3704184, -34.5903131), (-58.3706044, -34.590437), (-58.3704792, -34.5912233),
                    (-58.3702413, -34.5923548), (-58.3683149, -34.5982903), (-58.3695206, -34.598151),
                    (-58.3709513, -34.5982972), (-58.3736326, -34.5983155), (-58.3763891, -34.5985192),
                    (-58.3788685, -34.5986955), (-58.3813801, -34.5988761), (-58.381451, -34.5991804),
                    (-58.3795585, -34.5990342), (-58.375014, -34.59875), (-58.3708369, -34.5984522),
                    (-58.369352, -34.5983202), (-58.3682694, -34.598515), (-58.3676446, -34.600559),
                    (-58.3670558, -34.6051828), (-58.3665245, -34.6097778), (-58.3664378, -34.6108606),
                    (-58.3685891, -34.6110202), (-58.3698759, -34.6110916), (-58.3714287, -34.6111933),
                    (-58.3734008, -34.6112993), (-58.3758183, -34.611423), (-58.3759398, -34.6115907),
                    (-58.3726102, -34.6113524), (-58.3699936, -34.6111891), (-58.3685663, -34.6111409),
                    (-58.3663951, -34.6110055), (-58.3663578, -34.6114749), (-58.3663744, -34.6120383),
                    (-58.3664021, -34.6123176), (-58.3659857, -34.6167683), (-58.3681355, -34.6169104),
                    (-58.3707195, -34.617107), (-58.3727376, -34.6171118), (-58.3732107, -34.617087),
                    (-58.3751407, -34.6172055), (-58.3774431, -34.617361), (-58.3805132, -34.6175356),
                    (-58.3805408, -34.6177421), (-58.3786265, -34.6175954), (-58.3755023, -34.6173752),
                    (-58.3739863, -34.6172755), (-58.3730936, -34.6172212), (-58.3723445, -34.6172467),
                    (-58.3706972, -34.617223), (-58.3686257, -34.6171006), (-58.3659401, -34.6168847),
                    (-58.3657846, -34.6185137)],
            "name": "Área CLV Av. Alicia Moreau de Justo (Norte)",
            "color": "rgba(0, 0, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 0, 255, 0.3)"  # Contorno azul con 30% de opacidad
        },

        {
            "coords": [(-58.4264607, -34.6314187), (-58.4264017, -34.6316074), (-58.4255635, -34.6315335),
                    (-58.4217376, -34.6309608), (-58.4160524, -34.6303056), (-58.4086766, -34.6285528),
                    (-58.4002855, -34.627438), (-58.4003273, -34.6273119), (-58.408575, -34.6282477),
                    (-58.4160965, -34.6300918), (-58.4217206, -34.6307765), (-58.4256453, -34.6314055),
                    (-58.4258961, -34.6303229), (-58.4264773, -34.6271452), (-58.4212056, -34.626342),
                    (-58.4162129, -34.6257152), (-58.4163341, -34.625362), (-58.4266723, -34.6268454),
                    (-58.4276152, -34.6223237), (-58.4282888, -34.6187763), (-58.4286316, -34.6172051),
                    (-58.428964, -34.6158985), (-58.4292299, -34.6151848), (-58.4294199, -34.6152893),
                    (-58.4291463, -34.6163047), (-58.4288456, -34.6174175), (-58.4286084, -34.6187781),
                    (-58.4278635, -34.6223047), (-58.4268458, -34.6272034), (-58.4260751, -34.6303952),
                    (-58.4259001, -34.6314121), (-58.4264607, -34.6314187)],
            "name": "Área CLV Av. Asamblea (este)",
            "color": "rgba(100, 255, 0, 0.2)",  # Color verde con 20% de opacidad
            "line_color": "rgba(0, 255, 0, 0.3)"  # Contorno verde con 30% de opacidad
        },

        {
            "coords": [(-58.5284778, -34.6165043), (-58.5283799, -34.6165838), (-58.5277188, -34.6160463),
                    (-58.52506, -34.6140825), (-58.518001, -34.6196265), (-58.5176796, -34.6193608),
                    (-58.5248904, -34.6139906), (-58.5200688, -34.6110087), (-58.5178549, -34.6097511),
                    (-58.5063177, -34.6027916), (-58.4973437, -34.5970821), (-58.4976397, -34.5968833),
                    (-58.5022485, -34.5996695), (-58.5067502, -34.602438), (-58.5177832, -34.609396),
                    (-58.5200076, -34.6106833), (-58.5250721, -34.6138325), (-58.5278556, -34.6159613),
                    (-58.5284778, -34.6165043)],
            "name": "Área CLV Av. Beiro (noreste)",
            "color": "rgba(255, 165, 0, 0.2)",  # Color naranja con 20% de opacidad
            "line_color": "rgba(255, 165, 0, 0.3)"  # Contorno naranja con 30% de opacidad
        },

        {
            "coords": [(-58.4056167, -34.6335692), (-58.4055657, -34.6336751), (-58.4019339, -34.6322451),
                    (-58.4006358, -34.6317529), (-58.3988347, -34.636423), (-58.396405, -34.6424939),
                    (-58.3961639, -34.6421387), (-58.3986858, -34.6360261), (-58.4003193, -34.6316304),
                    (-58.3988656, -34.6311195), (-58.3974949, -34.6307311), (-58.3884025, -34.6289721),
                    (-58.3824226, -34.6279784), (-58.3792607, -34.6277896), (-58.3794354, -34.627583),
                    (-58.3802216, -34.6276811), (-58.3825528, -34.6277527), (-58.3891378, -34.6289169),
                    (-58.3907607, -34.6292005), (-58.391379, -34.6239128), (-58.3914348, -34.6221129),
                    (-58.3915534, -34.6196874), (-58.3915965, -34.6176352), (-58.3914852, -34.6156834),
                    (-58.3915834, -34.61385), (-58.3917233, -34.6104512), (-58.3919866, -34.6103814),
                    (-58.3917782, -34.6139062), (-58.3916957, -34.6157933), (-58.3917736, -34.6173331),
                    (-58.391779, -34.6183554), (-58.391672, -34.6212968), (-58.3916302, -34.6221582),
                    (-58.3915702, -34.6238645), (-58.391064, -34.6292635), (-58.397625, -34.6306163),
                    (-58.3990748, -34.6310665), (-58.4020681, -34.6321391), (-58.4056167, -34.6335692)],
            "name": "Área CLV Av. Brasil (noreste)",
            "color": "rgba(0, 150, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 0, 255, 0.3)"  # Contorno azul con 30% de opacidad
        },

        {
            "coords": [(-58.5059675, -34.5717411), (-58.5060292, -34.5718228), (-58.5049214, -34.572417),
                    (-58.5041449, -34.5728454), (-58.50313, -34.5734837), (-58.5002371, -34.5757303),
                    (-58.4971454, -34.5781934), (-58.4943394, -34.5802468), (-58.4935366, -34.5808406),
                    (-58.4926331, -34.5815997), (-58.4911238, -34.5829267), (-58.4889682, -34.5848153),
                    (-58.4862004, -34.5877606), (-58.4848746, -34.5890926), (-58.4847289, -34.5890026),
                    (-58.4860933, -34.5874908), (-58.4888188, -34.5846723), (-58.4912453, -34.5825755),
                    (-58.4925182, -34.5815284), (-58.4934525, -34.5808117), (-58.4969827, -34.5781477),
                    (-58.500619, -34.5753112), (-58.4995105, -34.574713), (-58.4960945, -34.5728965),
                    (-58.4954421, -34.5725755), (-58.4945526, -34.5721412), (-58.491372, -34.5705701),
                    (-58.4915413, -34.5704119), (-58.4933199, -34.5713844), (-58.4954805, -34.5725313),
                    (-58.4968514, -34.5732439), (-58.4990407, -34.5744017), (-58.5007059, -34.5752698),
                    (-58.5030271, -34.5734505), (-58.5040658, -34.5727924), (-58.5048463, -34.5723374),
                    (-58.5059675, -34.5717411)],
            "name": "Área CLV Av. Constituyentes (sureste)",
            "color": "rgba(28, 100, 128, 0.2)",  # Color púrpura con 20% de opacidad
            "line_color": "rgba(128, 0, 128, 0.3)"  # Contorno púrpura con 30% de opacidad
        },

        {
            "coords": [(-58.4678581, -34.6961049), (-58.4676596, -34.6962482), (-58.4668656, -34.6954742),
                    (-58.4643482, -34.6931349), (-58.4615953, -34.6906763), (-58.4582355, -34.6876687),
                    (-58.456768, -34.6863699), (-58.4553692, -34.6849604), (-58.4538202, -34.683542),
                    (-58.4523775, -34.6822434), (-58.4507525, -34.6809977), (-58.4497683, -34.6800198),
                    (-58.4492728, -34.6793363), (-58.4487734, -34.6777692), (-58.4482409, -34.6770014),
                    (-58.446898, -34.6747547), (-58.4456101, -34.672671), (-58.4449904, -34.671828),
                    (-58.4442729, -34.671005), (-58.4433693, -34.6699301), (-58.4425936, -34.6689003),
                    (-58.4418981, -34.6680803), (-58.4404421, -34.6667635), (-58.4396526, -34.6660518),
                    (-58.4386505, -34.6655319), (-58.4349238, -34.6639547), (-58.4317409, -34.6621954),
                    (-58.4321342, -34.6620835), (-58.4350381, -34.6636659), (-58.4388287, -34.6654003),
                    (-58.4399359, -34.6660107), (-58.4407065, -34.6667845), (-58.4419902, -34.6679527),
                    (-58.4427797, -34.6686898), (-58.4436525, -34.6698471), (-58.444236, -34.6705052),
                    (-58.4449179, -34.6713467), (-58.4455428, -34.6721714), (-58.4458136, -34.6726607),
                    (-58.4471002, -34.674705), (-58.4485344, -34.677032), (-58.4489085, -34.6776758),
                    (-58.4492074, -34.6783814), (-58.4495819, -34.6792529), (-58.4500252, -34.6796304),
                    (-58.4506224, -34.6795853), (-58.4549492, -34.6761827), (-58.4562442, -34.675128),
                    (-58.4578232, -34.6739555), (-58.4580547, -34.6736683), (-58.4581468, -34.67339),
                    (-58.4582828, -34.6736759), (-58.4573315, -34.6745654), (-58.4561551, -34.6754762),
                    (-58.4508163, -34.6796709), (-58.4500393, -34.6799814), (-58.4508951, -34.6808827),
                    (-58.452459, -34.6820619), (-58.4552284, -34.684596), (-58.4569398, -34.6862098),
                    (-58.4575193, -34.6861468), (-58.4623742, -34.6825682), (-58.4653099, -34.6804251),
                    (-58.465426, -34.6805975), (-58.4627311, -34.6825521), (-58.4575517, -34.6863649),
                    (-58.4574879, -34.6866953), (-58.4585941, -34.6876558), (-58.4618281, -34.6905894),
                    (-58.4644321, -34.6930696), (-58.467048, -34.6953771), (-58.4678581, -34.6961049)],
            "name": "Área CLV Av. Coronel Roca (noreste)",
            "color": "rgba(0, 28, 128, 0.2)",  # Color verde azulado con 20% de opacidad
            "line_color": "rgba(0, 128, 128, 0.3)"  # Contorno verde azulado con 30% de opacidad
        },

        {
            "coords": [(-58.4812867, -34.6422379), (-58.4811231, -34.6423483), (-58.4799913, -34.6414204),
                    (-58.4780775, -34.642978), (-58.4768176, -34.6439557), (-58.4746416, -34.6456663),
                    (-58.4727807, -34.6471884), (-58.4703038, -34.6490472), (-58.4701168, -34.6488381),
                    (-58.4718395, -34.6476405), (-58.4735483, -34.6462833), (-58.4752981, -34.6448967),
                    (-58.4770294, -34.6435604), (-58.4786743, -34.6422716), (-58.4798357, -34.6413133),
                    (-58.4766653, -34.6393515), (-58.4745611, -34.6380909), (-58.4733565, -34.6373234),
                    (-58.4728649, -34.6371822), (-58.4673548, -34.6355713), (-58.4594312, -34.6332132),
                    (-58.4545214, -34.6316173), (-58.4515237, -34.6307085), (-58.4399837, -34.6290182),
                    (-58.4386598, -34.6288824), (-58.4271439, -34.6271801), (-58.4185679, -34.6258805),
                    (-58.4185751, -34.6256578), (-58.4273655, -34.6269606), (-58.4387735, -34.6286407),
                    (-58.4400739, -34.6288283), (-58.451691, -34.6305501), (-58.4545469, -34.6313985),
                    (-58.459812, -34.633062), (-58.4676972, -34.6354609), (-58.4732423, -34.6370764),
                    (-58.4736002, -34.6372708), (-58.476373, -34.6389135), (-58.4798786, -34.6410883),
                    (-58.4806403, -34.6416841), (-58.4812867, -34.6422379)],
            "name": "Área CLV Av. Directorio (noreste)",
            "color": "rgba(128, 0, 128, 0.2)",  # Color púrpura con 20% de opacidad
            "line_color": "rgba(128, 0, 128, 0.3)"  # Contorno púrpura con 30% de opacidad
        },

        {
            "coords": [(-58.4213914, -34.5674461), (-58.4225041, -34.5691057), (-58.423971, -34.5705267),
                    (-58.4366333, -34.5634001), (-58.4389679, -34.5624484), (-58.4426849, -34.5618148),
                    (-58.4440567, -34.5607419), (-58.4451239, -34.5593295), (-58.4452898, -34.5595428),
                    (-58.4442269, -34.560853), (-58.4428829, -34.5619233), (-58.4391589, -34.5627588),
                    (-58.4368822, -34.5635287), (-58.4242989, -34.5707957), (-58.4244075, -34.5710525),
                    (-58.4271448, -34.572608), (-58.4304164, -34.5739934), (-58.4315563, -34.574355),
                    (-58.4313927, -34.574487), (-58.4302823, -34.5741502), (-58.4269499, -34.5727572),
                    (-58.4241786, -34.5711773), (-58.4235398, -34.5713421), (-58.4268127, -34.5778064),
                    (-58.4264268, -34.577909), (-58.4250931, -34.5749582), (-58.4250684, -34.574746),
                    (-58.4243477, -34.5732721), (-58.4234124, -34.5713919), (-58.4209703, -34.5724067),
                    (-58.4181112, -34.5737015), (-58.415574, -34.5750492), (-58.4206065, -34.5804852),
                    (-58.4215646, -34.580414), (-58.4223939, -34.5809258), (-58.4208186, -34.581966),
                    (-58.4204841, -34.5821985), (-58.419699, -34.5812296), (-58.4201029, -34.5810939),
                    (-58.4201597, -34.5807519), (-58.4150003, -34.5752932), (-58.4141367, -34.5754602),
                    (-58.4112225, -34.5767188), (-58.4070603, -34.5786506), (-58.4049495, -34.5803901),
                    (-58.4035716, -34.5814455), (-58.4012248, -34.5821941), (-58.3990355, -34.5828748),
                    (-58.3967555, -34.5832923), (-58.3955015, -34.5836793), (-58.3943753, -34.5840499),
                    (-58.3920231, -34.5847984), (-58.3904453, -34.5851048), (-58.3897182, -34.5850401),
                    (-58.3888954, -34.5853242), (-58.3872977, -34.5860334), (-58.3850341, -34.5872088),
                    (-58.3818584, -34.5888982), (-58.3817646, -34.5887404), (-58.3836287, -34.5878053),
                    (-58.3855386, -34.5867501), (-58.3872878, -34.5858681), (-58.3887915, -34.5851402),
                    (-58.3897422, -34.5848782), (-58.3904124, -34.58489), (-58.3918488, -34.5846195),
                    (-58.3942791, -34.583864), (-58.3955135, -34.5834746), (-58.396707, -34.5830562),
                    (-58.3988954, -34.5826987), (-58.401115, -34.5820108), (-58.4035991, -34.5812201),
                    (-58.4048236, -34.5802746), (-58.4068891, -34.5784977), (-58.4110851, -34.5766105),
                    (-58.4133938, -34.5755835), (-58.4142817, -34.5753004), (-58.4149739, -34.5749851),
                    (-58.4177045, -34.5736208), (-58.4204566, -34.5723802), (-58.4239019, -34.5709446),
                    (-58.4222469, -34.5692484), (-58.4211714, -34.5675919), (-58.4213914, -34.5674461)],
            "name": "Área CLV Av. Dorrego (suroeste)",
            "color": "rgba(255, 165, 0, 0.2)",  # Color naranja con 20% de opacidad
            "line_color": "rgba(255, 165, 0, 0.3)"  # Contorno naranja con 30% de opacidad
        },

        {
            "coords": [(-58.4212469, -34.6083969), (-58.4211933, -34.6087412), (-58.4201807, -34.608717),
                    (-58.4194686, -34.6086927), (-58.4154694, -34.6086883), (-58.4147774, -34.608494),
                    (-58.4146553, -34.6094432), (-58.4144441, -34.6094499), (-58.4091912, -34.6091093),
                    (-58.4090217, -34.6105373), (-58.4056493, -34.6102661), (-58.4057837, -34.6088923),
                    (-58.4058136, -34.608723), (-58.414478, -34.6091794), (-58.4145548, -34.6084145),
                    (-58.4139888, -34.6080525), (-58.4136187, -34.6070458), (-58.4131145, -34.6042376),
                    (-58.4104845, -34.6041773), (-58.4090836, -34.6042), (-58.403756, -34.6048762),
                    (-58.3981633, -34.6046939), (-58.3953991, -34.6046115), (-58.3924204, -34.6045909),
                    (-58.386633, -34.6041637), (-58.3825377, -34.6039147), (-58.3808886, -34.6039659),
                    (-58.38092, -34.6033557), (-58.382279, -34.6034597), (-58.3921998, -34.6043229),
                    (-58.3980733, -34.6044173), (-58.40101, -34.6045704), (-58.4039682, -34.6045556),
                    (-58.4067134, -34.6042201), (-58.4087828, -34.6039463), (-58.4100642, -34.6039088),
                    (-58.4113242, -34.6038624), (-58.4129536, -34.6039285), (-58.4121727, -34.6002998),
                    (-58.4115314, -34.5963796), (-58.410335, -34.5942953), (-58.409297, -34.5923082),
                    (-58.4083488, -34.5913587), (-58.4077011, -34.5909657), (-58.4080015, -34.5907294),
                    (-58.4086882, -34.5912262), (-58.4096859, -34.5922618), (-58.410512, -34.593739),
                    (-58.4118639, -34.5967153), (-58.411931, -34.5972705), (-58.4121268, -34.5983027),
                    (-58.4124111, -34.5999784), (-58.413087, -34.602959), (-58.4133874, -34.6042042),
                    (-58.413602, -34.6051579), (-58.4137791, -34.6061646), (-58.4140848, -34.6075068),
                    (-58.4145676, -34.6080102), (-58.4151791, -34.6082487), (-58.4159719, -34.6083608),
                    (-58.4162282, -34.6083758), (-58.4212469, -34.6083969)],
            "name": "Área CLV Av. Díaz Vélez (este)",
            "color": "rgba(0, 128, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 128, 255, 0.3)"  # Contorno azul con 30% de opacidad
        },

        {
            "coords": [(-58.3718251, -34.5933011), (-58.3698678, -34.5981116), (-58.3814016, -34.5989512),
                    (-58.3814537, -34.599134), (-58.3697152, -34.598415), (-58.3686614, -34.6010145),
                    (-58.3674036, -34.6109021), (-58.3758183, -34.611423), (-58.3759398, -34.6115907),
                    (-58.3674009, -34.6110763), (-58.366717, -34.6168047), (-58.3706275, -34.6170933),
                    (-58.3727376, -34.6171118), (-58.373157, -34.6170782), (-58.3805132, -34.6175356),
                    (-58.3805408, -34.6177421), (-58.3730936, -34.6172212), (-58.3706972, -34.617223),
                    (-58.3667504, -34.6169584), (-58.3662384, -34.6215174), (-58.3685251, -34.6222429),
                    (-58.3718458, -34.6222789), (-58.3726465, -34.622449), (-58.3727498, -34.6225397),
                    (-58.3740399, -34.6226415), (-58.3775483, -34.6226792), (-58.3798912, -34.622394),
                    (-58.3805051, -34.622209), (-58.3810224, -34.6223419), (-58.3812876, -34.6226998),
                    (-58.3816923, -34.6228371), (-58.3833063, -34.6227408), (-58.3870572, -34.6229088),
                    (-58.3871732, -34.6231694), (-58.3833838, -34.6228649), (-58.3812994, -34.6229139),
                    (-58.3810322, -34.6233921), (-58.3800856, -34.6252157), (-58.3794386, -34.6272055),
                    (-58.3788048, -34.6289124), (-58.3785819, -34.6297894), (-58.3787676, -34.6318007),
                    (-58.3785441, -34.6327186), (-58.3783634, -34.6331951), (-58.37808, -34.6342499),
                    (-58.3773869, -34.6366013), (-58.3759967, -34.643533), (-58.3757469, -34.645057),
                    (-58.375336, -34.6463338), (-58.3741128, -34.649001), (-58.3732383, -34.6505239),
                    (-58.3722848, -34.6526389), (-58.3715314, -34.6551049), (-58.3713908, -34.6550118),
                    (-58.3721084, -34.6526461), (-58.3730479, -34.6504822), (-58.3739303, -34.6489224),
                    (-58.3751855, -34.646249), (-58.3753088, -34.6459994), (-58.3755393, -34.6451805),
                    (-58.3756893, -34.6440811), (-58.3771691, -34.6365412), (-58.3778525, -34.6342741),
                    (-58.3781828, -34.6331508), (-58.3785601, -34.6319235), (-58.3783525, -34.6297864),
                    (-58.3785951, -34.6289183), (-58.3792653, -34.627141), (-58.3799717, -34.6251342),
                    (-58.3808878, -34.6233753), (-58.3810654, -34.6229169), (-58.3775698, -34.6228935),
                    (-58.3740615, -34.6228276), (-58.3717442, -34.6225104), (-58.3684401, -34.6224247),
                    (-58.3661556, -34.6218737), (-58.3659255, -34.6238753), (-58.3681678, -34.6239746),
                    (-58.3682429, -34.6241391), (-58.3681437, -34.627257), (-58.3679901, -34.6276082),
                    (-58.3650809, -34.6294171), (-58.3634323, -34.6304685), (-58.3624233, -34.6311341),
                    (-58.3610432, -34.6319858), (-58.3608296, -34.6321391), (-58.3603766, -34.6329543),
                    (-58.3598432, -34.6336852), (-58.3594288, -34.6336886), (-58.3589014, -34.6337998),
                    (-58.3584423, -34.6345118), (-58.3579735, -34.6353893), (-58.3573413, -34.6365842),
                    (-58.3567541, -34.6372624), (-58.3556203, -34.6382088), (-58.3554503, -34.6381082),
                    (-58.3565463, -34.6371779), (-58.357154, -34.6365283), (-58.3578249, -34.635325),
                    (-58.3582772, -34.6345102), (-58.3588094, -34.63367), (-58.3593503, -34.6335756),
                    (-58.3597546, -34.6335243), (-58.3606638, -34.6321364), (-58.3609594, -34.6318864),
                    (-58.3623561, -34.6310366), (-58.3633724, -34.6303785), (-58.3649004, -34.6292997),
                    (-58.3678258, -34.6274828), (-58.3679458, -34.6270307), (-58.36798, -34.6241242),
                    (-58.3655285, -34.624074), (-58.3642518, -34.62482), (-58.3635598, -34.625129),
                    (-58.3614221, -34.6258132), (-58.3590477, -34.6270349), (-58.3561259, -34.628883),
                    (-58.3550575, -34.6299145), (-58.354195, -34.6312052), (-58.3537969, -34.6320885),
                    (-58.3537404, -34.6334304), (-58.3538254, -34.6354542), (-58.3536375, -34.636759),
                    (-58.3534684, -34.6366257), (-58.3536212, -34.6355391), (-58.3535028, -34.6334878),
                    (-58.3536408, -34.6320446), (-58.3540212, -34.6311532), (-58.3549203, -34.6297946),
                    (-58.356092, -34.6286859), (-58.3589763, -34.6268467), (-58.3612008, -34.6255903),
                    (-58.3631682, -34.624873), (-58.3656251, -34.623531), (-58.3681464, -34.6011735),
                    (-58.369503, -34.5974503), (-58.3713101, -34.5932326), (-58.3718251, -34.5933011)],
            "name": "Área CLV Av. Eduardo Madero (sur)",
            "color": "rgba(255, 165, 0, 0.2)",  # Color naranja con 20% de opacidad
            "line_color": "rgba(255, 165, 0, 0)"  # Contorno azul con 30% de opacidad
        },

        {
            "coords": [(-58.5223353, -34.6549777), (-58.5221314, -34.6552336), (-58.5171692, -34.6528817),
                    (-58.5144145, -34.6515656), (-58.5121379, -34.6531831), (-58.5079299, -34.6561861),
                    (-58.5078191, -34.6561036), (-58.5092156, -34.6550966), (-58.5126425, -34.6526466),
                    (-58.5142723, -34.6515028), (-58.5066014, -34.6479171), (-58.50221, -34.6514522),
                    (-58.5019646, -34.6512472), (-58.5062253, -34.6477943), (-58.4980119, -34.6438938),
                    (-58.4981622, -34.6437349), (-58.5064738, -34.6476947), (-58.5157556, -34.6405363),
                    (-58.5158316, -34.640695), (-58.5068142, -34.6477443), (-58.5223353, -34.6549777)],
            "name": "Área CLV Av. Emilio Castro (noreste)",
            "color": "rgba(0, 128, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 128, 255, 0.8)",  # Color azul con 80% de opacidad
        },

        {
            "coords": [(-58.49811, -34.6720381), (-58.4966436, -34.670942), (-58.4952014, -34.6696186),
                    (-58.4910467, -34.6653853), (-58.4842249, -34.6707765), (-58.4776169, -34.6755497),
                    (-58.4776106, -34.6753531), (-58.4837095, -34.6708365), (-58.4908751, -34.6652562),
                    (-58.4898558, -34.6643242), (-58.4888366, -34.6634218), (-58.4858883, -34.6624929),
                    (-58.4849679, -34.6619567), (-58.48176, -34.6599113), (-58.478858, -34.6579708),
                    (-58.4719997, -34.6633633), (-58.4718483, -34.6630282), (-58.4786382, -34.6577953),
                    (-58.475356, -34.6549575), (-58.4751961, -34.6548195), (-58.4690711, -34.6491743),
                    (-58.469334, -34.6490066), (-58.469511, -34.6490949), (-58.4700099, -34.6496686),
                    (-58.4709594, -34.6505688), (-58.4718874, -34.6514426), (-58.4728262, -34.6521928),
                    (-58.4753217, -34.6545434), (-58.4766124, -34.655657), (-58.4779997, -34.6569911),
                    (-58.4786952, -34.6576133), (-58.4810402, -34.6535694), (-58.4812501, -34.65355),
                    (-58.4788114, -34.6577059), (-58.4852626, -34.6525861), (-58.4854909, -34.6526997),
                    (-58.4789526, -34.6578692), (-58.4841043, -34.6611829), (-58.4851701, -34.6618446),
                    (-58.4860391, -34.6623741), (-58.4867741, -34.6626212), (-58.4872139, -34.6627668),
                    (-58.4887943, -34.6632088), (-58.488982, -34.6631664), (-58.4954994, -34.6575467),
                    (-58.5019646, -34.6512472), (-58.50221, -34.6514522), (-58.495767, -34.6577091),
                    (-58.4890389, -34.6633551), (-58.4903209, -34.6644274), (-58.4909432, -34.6650539),
                    (-58.4919088, -34.6659363), (-58.4950733, -34.6692946), (-58.4954548, -34.6696421),
                    (-58.4960348, -34.6702323), (-58.4970821, -34.6711083), (-58.4976443, -34.6715368),
                    (-58.4982118, -34.6719212), (-58.49811, -34.6720381)],
            "name": "Área CLV Av. Eva Perón (noreste)",
            "color": "rgba(255, 0, 0, 0.2)",  # Color rojo con 20% de opacidad
            "line_color": "rgba(255, 0, 0, 0.8)",  # Color rojo con 80% de opacidad
        },

        {
            "coords": [(-58.4053295, -34.6133838), (-58.4049097, -34.6148894), (-58.4036266, -34.6187555),
                    (-58.4088473, -34.6198854), (-58.4125665, -34.6205851), (-58.4163286, -34.6209101),
                    (-58.4163, -34.6211521), (-58.4124948, -34.6208466), (-58.4088183, -34.6200663),
                    (-58.4035215, -34.6190022), (-58.4031482, -34.6201848), (-58.4025469, -34.6224224),
                    (-58.401954, -34.6256597), (-58.4060565, -34.6262454), (-58.4124808, -34.6268042),
                    (-58.4171983, -34.627478), (-58.4172396, -34.6276472), (-58.4129464, -34.6270571),
                    (-58.4104718, -34.626829), (-58.4079758, -34.6267069), (-58.4060735, -34.6265507),
                    (-58.4019278, -34.6260262), (-58.4018762, -34.6262307), (-58.4015677, -34.6261573),
                    (-58.3998339, -34.6257983), (-58.3949279, -34.6246612), (-58.3961266, -34.6246542),
                    (-58.4000046, -34.6255761), (-58.401628, -34.6258954), (-58.4016883, -34.6256601),
                    (-58.4024605, -34.6221349), (-58.4030496, -34.6201738), (-58.4048427, -34.6147259),
                    (-58.4017752, -34.6145361), (-58.3981169, -34.6143143), (-58.393745, -34.614069),
                    (-58.3918098, -34.6139459), (-58.3917843, -34.6137256), (-58.3938041, -34.6139385),
                    (-58.3982245, -34.6141807), (-58.4018191, -34.6143816), (-58.4048467, -34.6145759),
                    (-58.4052477, -34.6133662), (-58.4053295, -34.6133838)],
            "name": "Área CLV Av. Jujuy (sur)",
            "color": "rgba(0, 0, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 0, 255, 0.8)",  # Color azul con 80% de opacidad
        },

        {
            "coords": [(-58.3731938, -34.5947407), (-58.3726519, -34.5957741), (-58.3717843, -34.5976),
                    (-58.3714827, -34.5983007), (-58.3730244, -34.5984612), (-58.3786629, -34.5988126),
                    (-58.3839859, -34.599097), (-58.3857354, -34.5991685), (-58.385312, -34.6027544),
                    (-58.3834587, -34.6027016), (-58.3836011, -34.599346), (-58.3767591, -34.5989079),
                    (-58.3713957, -34.5985069), (-58.371237, -34.5986263), (-58.3709604, -34.5996111),
                    (-58.3707128, -34.6007596), (-58.3705019, -34.6029593), (-58.3703823, -34.6044834),
                    (-58.3702942, -34.6057137), (-58.3703939, -34.6069087), (-58.3713764, -34.6077395),
                    (-58.3736383, -34.6079283), (-58.3736083, -34.6084049), (-58.380567, -34.608917),
                    (-58.387124, -34.6092746), (-58.387284, -34.6088375), (-58.3899463, -34.6090759),
                    (-58.3915372, -34.6091212), (-58.391669, -34.6103673), (-58.3894007, -34.6101399),
                    (-58.3873009, -34.6099633), (-58.3872571, -34.6096079), (-58.387055, -34.6096035),
                    (-58.3805274, -34.6092083), (-58.3735783, -34.6086696), (-58.3735184, -34.6091812),
                    (-58.3709074, -34.6090688), (-58.3708247, -34.6076431), (-58.3702469, -34.6071412),
                    (-58.3700921, -34.6062213), (-58.3693412, -34.6065693), (-58.3689255, -34.6068947),
                    (-58.3686848, -34.6073006), (-58.3686005, -34.6075985), (-58.3685982, -34.6079357),
                    (-58.3687263, -34.6084682), (-58.3690106, -34.6087941), (-58.3692734, -34.6090053),
                    (-58.3697347, -34.6092499), (-58.3697025, -34.6102317), (-58.3695898, -34.6114528),
                    (-58.3696233, -34.6128927), (-58.3696143, -34.6138012), (-58.3695936, -34.6149),
                    (-58.369579, -34.6159021), (-58.3695633, -34.6169726), (-58.369609, -34.6175659),
                    (-58.3695997, -34.6178051), (-58.369191, -34.618899), (-58.368967, -34.619485),
                    (-58.3687859, -34.6205831), (-58.3684706, -34.6221314), (-58.3681145, -34.6220138),
                    (-58.3683593, -34.6205984), (-58.3689223, -34.6188986), (-58.3693509, -34.6177591),
                    (-58.3692899, -34.6174571), (-58.3691882, -34.6169262), (-58.3692641, -34.6158622),
                    (-58.3693047, -34.6148466), (-58.3694202, -34.6130255), (-58.3694316, -34.6120987),
                    (-58.3694772, -34.6105989), (-58.3695522, -34.6095268), (-58.3693913, -34.6092827),
                    (-58.3687582, -34.6087918), (-58.3685541, -34.6084796), (-58.3684623, -34.6082217),
                    (-58.3684242, -34.6078932), (-58.368441, -34.6075433), (-58.3685728, -34.6070442),
                    (-58.368896, -34.606708), (-58.3692716, -34.6064051), (-58.3697653, -34.6060396),
                    (-58.369889, -34.6057783), (-58.3701052, -34.6053338), (-58.3702197, -34.6030756),
                    (-58.3704364, -34.6007788), (-58.3709535, -34.5985306), (-58.3715818, -34.5975448),
                    (-58.3724964, -34.595721), (-58.3730328, -34.5947032), (-58.3731938, -34.5947407)],
            "name": "Área CLV Av. Leandro N. Alem (sur)",
            "color": "rgba(0, 0, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 0, 255, 0.8)",  # Color azul con 80% de opacidad
        },

        {
            "coords": [(-58.4903296, -34.5524808), (-58.4898387, -34.5531722), (-58.4887323, -34.5548053),
                    (-58.4885804, -34.5550589), (-58.4882326, -34.5557453), (-58.4870178, -34.5575007),
                    (-58.4863299, -34.5585282), (-58.4852205, -34.5601933), (-58.4836812, -34.5622871),
                    (-58.4815449, -34.5650857), (-58.481394, -34.5650448), (-58.4829276, -34.5630867),
                    (-58.4835473, -34.5621898), (-58.4851893, -34.5599984), (-58.4860765, -34.5586589),
                    (-58.4869027, -34.5574536), (-58.4880726, -34.555654), (-58.4884017, -34.5550563),
                    (-58.4872989, -34.5550225), (-58.4841398, -34.554939), (-58.483621, -34.555065),
                    (-58.4797643, -34.5566759), (-58.4771935, -34.5577877), (-58.4749013, -34.5587637),
                    (-58.4719343, -34.5600116), (-58.4714916, -34.5600701), (-58.4722182, -34.5597752),
                    (-58.4752644, -34.5584806), (-58.4780988, -34.5572826), (-58.4805962, -34.5562016),
                    (-58.4835795, -34.5549612), (-58.4841565, -34.5548201), (-58.4873226, -34.5548827),
                    (-58.4884644, -34.5549256), (-58.4885271, -34.5547948), (-58.4897153, -34.5531126),
                    (-58.4902089, -34.5524145), (-58.4903296, -34.5524808)],
            "name": "Área CLV Av. Parque Goyeneche (sureste)",
            "color": "rgba(0, 0, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 0, 255, 0.8)",  # Color azul con 80% de opacidad
        },

        {
            "coords": [(-58.3695909, -34.6134024), (-58.3695828, -34.6142302), (-58.3694922, -34.616947),
                    (-58.3695064, -34.6170311), (-58.3705032, -34.6171107), (-58.3727001, -34.6171559),
                    (-58.3730989, -34.6170861), (-58.3760847, -34.6172651), (-58.3804467, -34.6175064),
                    (-58.3812491, -34.6175652), (-58.3812748, -34.6178241), (-58.3812088, -34.6188071),
                    (-58.3813058, -34.6205435), (-58.3812097, -34.6222799), (-58.3801987, -34.6252118),
                    (-58.3785754, -34.6300631), (-58.3787301, -34.6318448), (-58.3772084, -34.6372074),
                    (-58.3762432, -34.6419905), (-58.375723, -34.6451766), (-58.3741606, -34.6488814),
                    (-58.372813, -34.6515397), (-58.3722473, -34.652683), (-58.3714939, -34.655149),
                    (-58.3713533, -34.6550559), (-58.3717208, -34.6538131), (-58.3721081, -34.6526198),
                    (-58.3730104, -34.6505263), (-58.3747226, -34.6472022), (-58.3755675, -34.6448674),
                    (-58.3762007, -34.6413892), (-58.3770814, -34.6367968), (-58.3785226, -34.6319676),
                    (-58.378315, -34.6298305), (-58.3798274, -34.6253269), (-58.3808293, -34.6222107),
                    (-58.3809102, -34.6187777), (-58.3808853, -34.6178123), (-58.3803563, -34.6178005),
                    (-58.3731374, -34.6173117), (-58.3729398, -34.6173077), (-58.3704759, -34.6172917),
                    (-58.3695152, -34.6172211), (-58.3695558, -34.6177808), (-58.3689786, -34.619318),
                    (-58.3684614, -34.6216115), (-58.3682678, -34.6234629), (-58.3681788, -34.6253156),
                    (-58.3678538, -34.6252967), (-58.3629495, -34.6252285), (-58.3605622, -34.6262276),
                    (-58.3570525, -34.6282871), (-58.3560989, -34.6289643), (-58.3551882, -34.6298004),
                    (-58.3538021, -34.6320348), (-58.3537345, -34.6335468), (-58.3538424, -34.6354012),
                    (-58.3536386, -34.6366615), (-58.3535208, -34.6361474), (-58.3535425, -34.6344837),
                    (-58.3534953, -34.6332756), (-58.3537893, -34.6315678), (-58.3550297, -34.6296804),
                    (-58.3562471, -34.628593), (-58.3586068, -34.6271155), (-58.3611682, -34.6256021),
                    (-58.3629489, -34.624987), (-58.3633989, -34.6251074), (-58.3679239, -34.6251476),
                    (-58.3680584, -34.6234887), (-58.3682139, -34.6218017), (-58.3682672, -34.6216238),
                    (-58.3685022, -34.6203028), (-58.369088, -34.6185683), (-58.3694033, -34.6177842),
                    (-58.3693129, -34.6172171), (-58.369273, -34.6169531), (-58.3693602, -34.6142545),
                    (-58.3693977, -34.6133737), (-58.3695909, -34.6134024)],
            "name": "Área CLV Av. Paseo Colón (sur)",
            "color": "rgba(0, 0, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 0, 255, 0.8)",  # Color azul con 80% de opacidad
        },

        {
            "coords": [(-58.4975206, -34.5540304), (-58.4972658, -34.554343), (-58.4964233, -34.5554967),
                    (-58.496395, -34.5560214), (-58.4969334, -34.5564915), (-58.4970305, -34.556715),
                    (-58.4969824, -34.556977), (-58.4965091, -34.5575726), (-58.4960152, -34.5583047),
                    (-58.4959669, -34.5591526), (-58.4963062, -34.5612245), (-58.4967128, -34.5623741),
                    (-58.497013, -34.563068), (-58.4967823, -34.5634446), (-58.4936132, -34.5678193),
                    (-58.4917856, -34.5702956), (-58.4913868, -34.5701908), (-58.4927261, -34.5684605),
                    (-58.4939418, -34.5668401), (-58.4965301, -34.5633972), (-58.496648, -34.5628429),
                    (-58.4961539, -34.5617921), (-58.4958515, -34.5597974), (-58.4957254, -34.5589579),
                    (-58.4957574, -34.5583299), (-58.4964863, -34.557267), (-58.4967735, -34.5567088),
                    (-58.4965433, -34.5564464), (-58.49612, -34.5561309), (-58.4961454, -34.5556882),
                    (-58.4958191, -34.555847), (-58.4952387, -34.5558049), (-58.494627, -34.5554026),
                    (-58.4921111, -34.5552225), (-58.4911307, -34.5552349), (-58.4906711, -34.5551585),
                    (-58.4887108, -34.5550864), (-58.4888426, -34.5549435), (-58.4907157, -34.555029),
                    (-58.4911589, -34.5550794), (-58.4919877, -34.5551131), (-58.4944123, -34.5552477),
                    (-58.492886, -34.5543474), (-58.4900744, -34.5528852), (-58.4889526, -34.5544948),
                    (-58.4886004, -34.5550115), (-58.488134, -34.5560005), (-58.4856504, -34.5595696),
                    (-58.4843497, -34.5613718), (-58.4826673, -34.5636181), (-58.4815449, -34.5650857),
                    (-58.481394, -34.5650448), (-58.4828625, -34.5631696), (-58.4851411, -34.5600638),
                    (-58.4883653, -34.5551152), (-58.4885271, -34.5547948), (-58.4891881, -34.5538512),
                    (-58.4899218, -34.5527803), (-58.4890664, -34.5523131), (-58.4884825, -34.5517725),
                    (-58.4874835, -34.5514319), (-58.4841037, -34.5497031), (-58.4839373, -34.5495029),
                    (-58.4850262, -34.5500449), (-58.487601, -34.5513588), (-58.4884912, -34.5516491),
                    (-58.4888342, -34.5518423), (-58.4892718, -34.5522568), (-58.4902658, -34.5528412),
                    (-58.4918493, -34.5536675), (-58.4938382, -34.5546929), (-58.4943798, -34.5550837),
                    (-58.4953771, -34.5556569), (-58.4957397, -34.5556612), (-58.4961601, -34.5554221),
                    (-58.4971357, -34.5542922), (-58.4974053, -34.5539652), (-58.4975206, -34.5540304)],
            "name": "Área CLV Av. Ricardo Balbín (sureste)",
            "color": "rgba(0, 0, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 0, 255, 0.8)",  # Color azul con 80% de opacidad
        },

        {
            "coords": [(-58.4338346, -34.6170402), (-58.4345668, -34.617422), (-58.4364913, -34.6181615),
                    (-58.4367079, -34.6182995), (-58.437214, -34.6185326), (-58.4412109, -34.6202906),
                    (-58.4428566, -34.6210126), (-58.4456686, -34.622151), (-58.4488821, -34.6234532),
                    (-58.4503896, -34.6240866), (-58.4505536, -34.6242077), (-58.4519567, -34.6247481),
                    (-58.4541905, -34.6256011), (-58.4567056, -34.6265978), (-58.4598181, -34.6278606),
                    (-58.4629217, -34.6288495), (-58.4654679, -34.6294917), (-58.4697013, -34.6305649),
                    (-58.4695519, -34.6306714), (-58.4668732, -34.6299702), (-58.4653479, -34.6296661),
                    (-58.4597597, -34.6279755), (-58.4566543, -34.6266691), (-58.4554055, -34.6261762),
                    (-58.4541541, -34.625692), (-58.4519343, -34.6248406), (-58.4511238, -34.6245171),
                    (-58.4503025, -34.6241605), (-58.4487804, -34.6235369), (-58.4454872, -34.6222565),
                    (-58.4424423, -34.6210017), (-58.4410237, -34.6204415), (-58.4365721, -34.6184126),
                    (-58.4362123, -34.6188172), (-58.4358782, -34.6194283), (-58.435501, -34.6204452),
                    (-58.4349575, -34.6219819), (-58.4346928, -34.6229443), (-58.4345328, -34.6244033),
                    (-58.4343533, -34.6257965), (-58.4338685, -34.6279613), (-58.4334738, -34.6296303),
                    (-58.4347427, -34.6298853), (-58.4378575, -34.6303308), (-58.4389929, -34.6307865),
                    (-58.4407735, -34.6318009), (-58.4434341, -34.6334537), (-58.446701, -34.6356456),
                    (-58.4480756, -34.636123), (-58.4494492, -34.6362247), (-58.4515737, -34.6361784),
                    (-58.4528988, -34.6363699), (-58.4535304, -34.6364707), (-58.455992, -34.6378276),
                    (-58.4556242, -34.6380558), (-58.4537115, -34.6368364), (-58.4527446, -34.63654),
                    (-58.4517133, -34.6364025), (-58.4495354, -34.636397), (-58.4479482, -34.6362826),
                    (-58.4466634, -34.6358072), (-58.4432409, -34.6335351), (-58.4418675, -34.6326808),
                    (-58.4404297, -34.6318442), (-58.439233, -34.6311327), (-58.4380362, -34.6306154),
                    (-58.4366378, -34.6303261), (-58.433426, -34.6298577), (-58.4304845, -34.6293977),
                    (-58.4305411, -34.6291208), (-58.4333633, -34.6295116), (-58.43377, -34.6279101),
                    (-58.4342167, -34.6258126), (-58.4344157, -34.6243967), (-58.4345676, -34.6229267),
                    (-58.4348645, -34.6219734), (-58.4354242, -34.620407), (-58.4358929, -34.6192491),
                    (-58.4361904, -34.6186568), (-58.4363666, -34.6183359), (-58.4344864, -34.6175545),
                    (-58.4337058, -34.6172057), (-58.4338346, -34.6170402)],
            "name": "Área CLV Av. Rivadavia (suroeste)",
            "color": "rgba(255, 0, 0, 0.2)",  # Color rojo con 20% de opacidad
            "line_color": "rgba(255, 0, 0, 0.8)",  # Color rojo con 80% de opacidad
        },

        {
            "coords": [(-58.4163135, -34.6536689), (-58.4161794, -34.6536634), (-58.4161753, -34.6531857),
                    (-58.4161539, -34.6522242), (-58.4161338, -34.6497951), (-58.412257, -34.649613),
                    (-58.4090616, -34.6494505), (-58.4075037, -34.6494276), (-58.4071571, -34.6494814),
                    (-58.4066655, -34.6496206), (-58.405648, -34.6501585), (-58.4055318, -34.6500742),
                    (-58.4059574, -34.649789), (-58.4064849, -34.6495392), (-58.4071324, -34.6493411),
                    (-58.4075658, -34.6493075), (-58.4094389, -34.6493763), (-58.4122856, -34.6495015),
                    (-58.4161406, -34.6496668), (-58.416126, -34.6485236), (-58.4160885, -34.6481754),
                    (-58.4159706, -34.6480502), (-58.4150325, -34.6466441), (-58.4142159, -34.6452764),
                    (-58.4136443, -34.644032), (-58.4132291, -34.6431284), (-58.4126654, -34.6417142),
                    (-58.4121529, -34.6405232), (-58.4116976, -34.6394277), (-58.4113557, -34.6386248),
                    (-58.4110318, -34.6375326), (-58.4106436, -34.6362948), (-58.4104589, -34.6356737),
                    (-58.4104298, -34.6351364), (-58.4105508, -34.6351686), (-58.4105765, -34.6356701),
                    (-58.4106558, -34.6359687), (-58.4110166, -34.6369754), (-58.4113588, -34.6383357),
                    (-58.4114373, -34.6385391), (-58.4119235, -34.639643), (-58.412413, -34.6407842),
                    (-58.4128526, -34.6418226), (-58.4137045, -34.6438312), (-58.4142904, -34.6450957),
                    (-58.4151428, -34.6466141), (-58.4160685, -34.6480006), (-58.4161396, -34.6479511),
                    (-58.4161235, -34.6471856), (-58.416094, -34.6463923), (-58.4160839, -34.644709),
                    (-58.4160653, -34.6433371), (-58.4160607, -34.6424226), (-58.4159871, -34.6408401),
                    (-58.4159901, -34.6402525), (-58.4160239, -34.6394578), (-58.4160511, -34.6389656),
                    (-58.4162177, -34.6390383), (-58.4161649, -34.6403755), (-58.416171, -34.6423471),
                    (-58.4161901, -34.6433264), (-58.4162398, -34.6446131), (-58.416267, -34.6462473),
                    (-58.4162576, -34.6471879), (-58.4162737, -34.6484417), (-58.4163274, -34.6495989),
                    (-58.4184303, -34.6496896), (-58.4215149, -34.6497967), (-58.4241528, -34.6499294),
                    (-58.4295008, -34.6501259), (-58.4308753, -34.6502456), (-58.4310053, -34.6503565),
                    (-58.4252358, -34.6501282), (-58.4226387, -34.6499739), (-58.4184732, -34.6497803),
                    (-58.4163651, -34.6497455), (-58.4163175, -34.6521319), (-58.4163148, -34.6531648),
                    (-58.4163135, -34.6536689)],
            "name": "Área CLV Av. Sáenz (norte)",
            "color": "rgba(0, 255, 0, 0.2)",  # Color verde con 20% de opacidad
            "line_color": "rgba(0, 255, 0, 0.8)",  # Color verde con 80% de opacidad
        },

        {
            "coords": [(-58.3797679, -34.6088709), (-58.3805672, -34.6089317), (-58.3809943, -34.6089521),
                    (-58.3810609, -34.6079887), (-58.3812076, -34.6048547), (-58.3810163, -34.6043537),
                    (-58.3809689, -34.6031674), (-58.3813111, -34.6025175), (-58.3814503, -34.5998117),
                    (-58.3815763, -34.5972807), (-58.3818787, -34.5937179), (-58.3817397, -34.5916172),
                    (-58.3816299, -34.5899924), (-58.3813449, -34.5889944), (-58.3814921, -34.5887339),
                    (-58.3818325, -34.5899042), (-58.3819277, -34.5915472), (-58.3821801, -34.5938089),
                    (-58.3818807, -34.5973089), (-58.3816701, -34.5995715), (-58.3815788, -34.6024223),
                    (-58.3836332, -34.6025331), (-58.3835746, -34.5989965), (-58.3855758, -34.5991602),
                    (-58.3851902, -34.6027374), (-58.3836788, -34.6026768), (-58.3815678, -34.6025821),
                    (-58.3812671, -34.6031923), (-58.3812005, -34.6042417), (-58.3814472, -34.6048595),
                    (-58.3812255, -34.6079992), (-58.3811864, -34.6089591), (-58.3813999, -34.6090102),
                    (-58.3819033, -34.609012), (-58.384978, -34.6091834), (-58.3871683, -34.6093168),
                    (-58.3874261, -34.6088667), (-58.391471, -34.6091559), (-58.3914657, -34.6102631),
                    (-58.3872654, -34.6098955), (-58.3871369, -34.6094409), (-58.384949, -34.6092824),
                    (-58.3816557, -34.60909), (-58.3815691, -34.6100647), (-58.3815794, -34.6111923),
                    (-58.3813353, -34.6119024), (-58.3813396, -34.6125696), (-58.381462, -34.6130866),
                    (-58.3814092, -34.6141409), (-58.3811975, -34.6223398), (-58.3812849, -34.6226799),
                    (-58.3810295, -34.6233722), (-58.3800829, -34.6251958), (-58.3791209, -34.6282232),
                    (-58.3786127, -34.6297661), (-58.3787053, -34.6317056), (-58.3786647, -34.6321469),
                    (-58.3785178, -34.6328189), (-58.3782503, -34.6334531), (-58.378268, -34.6335592),
                    (-58.3779646, -34.634345), (-58.3777775, -34.6349207), (-58.377606, -34.6355468),
                    (-58.377488, -34.6360592), (-58.3773043, -34.6369945), (-58.3770518, -34.6382489),
                    (-58.3767849, -34.6396527), (-58.3758262, -34.6444054), (-58.3755851, -34.6456355),
                    (-58.3737788, -34.6497007), (-58.3730719, -34.6507516), (-58.3724937, -34.6521643),
                    (-58.3715733, -34.6550339), (-58.3713908, -34.6550118), (-58.372096, -34.6527338),
                    (-58.3730372, -34.6504645), (-58.3743327, -34.6481525), (-58.3754728, -34.6454003),
                    (-58.3756613, -34.6443122), (-58.3764154, -34.6407981), (-58.3766467, -34.6394941),
                    (-58.3768906, -34.638197), (-58.3771474, -34.6369631), (-58.37737, -34.6360044),
                    (-58.3775498, -34.635341), (-58.3776869, -34.6348652), (-58.3778679, -34.6342821),
                    (-58.3779912, -34.6339985), (-58.3781462, -34.6335131), (-58.3781573, -34.6334363),
                    (-58.3784271, -34.6327185), (-58.3785544, -34.632138), (-58.3786047, -34.6316677),
                    (-58.3784464, -34.6297732), (-58.3790912, -34.6275499), (-58.379854, -34.6253354),
                    (-58.3810627, -34.622897), (-58.3805182, -34.6230097), (-58.3785474, -34.6229572),
                    (-58.3772611, -34.6230042), (-58.3755769, -34.6230369), (-58.374307, -34.6229955),
                    (-58.373626, -34.62292), (-58.3717982, -34.6226837), (-58.3686268, -34.6226213),
                    (-58.3665921, -34.622566), (-58.3660347, -34.6227125), (-58.3655524, -34.6230444),
                    (-58.3650671, -34.6236385), (-58.3635695, -34.6247533), (-58.3613423, -34.6258328),
                    (-58.3573319, -34.6281249), (-58.3562656, -34.6287744), (-58.3548097, -34.6303174),
                    (-58.3543036, -34.6309746), (-58.3538499, -34.6318992), (-58.3537418, -34.6325971),
                    (-58.3537148, -34.6334392), (-58.3537778, -34.6353678), (-58.3536433, -34.6365076),
                    (-58.3535357, -34.636257), (-58.3536423, -34.6353278), (-58.3535697, -34.6331866),
                    (-58.3536391, -34.6322092), (-58.3539057, -34.6313849), (-58.3545217, -34.6302414),
                    (-58.3549203, -34.6297946), (-58.3561862, -34.6286227), (-58.3573984, -34.6278568),
                    (-58.3612008, -34.6255903), (-58.3633527, -34.6246643), (-58.3648608, -34.6235793),
                    (-58.3657035, -34.622737), (-58.3661551, -34.6225267), (-58.3666066, -34.6224224),
                    (-58.3692642, -34.6225413), (-58.3718801, -34.6225754), (-58.3735996, -34.6228092),
                    (-58.3746946, -34.6229098), (-58.375781, -34.6229284), (-58.3774821, -34.622879),
                    (-58.3785008, -34.6228405), (-58.3805678, -34.6228783), (-58.3808266, -34.6221908),
                    (-58.3811789, -34.6141515), (-58.3811954, -34.6130937), (-58.3811059, -34.6120014),
                    (-58.3813057, -34.6112174), (-58.3814181, -34.6099887), (-58.3814327, -34.6090771),
                    (-58.3808609, -34.6090465), (-58.3797586, -34.608957), (-58.3797679, -34.6088709)],
            "name": "Área CLV Av. Sáenz (norte)",
            "color": "rgba(255, 255, 80, 0.2)",  # Color verde con 20% de opacidad
            "line_color": "rgba(0, 255, 0, 0.8)",  # Color verde con 80% de opacidad
        },
        
        {
            "coords": [(-58.4782887, -34.5792793), (-58.4783115, -34.5793566), (-58.4778113, -34.5794881),
                    (-58.4755697, -34.5799825), (-58.4754662, -34.580058), (-58.4744366, -34.5812738),
                    (-58.4746954, -34.5814656), (-58.479403, -34.5849578), (-58.4799121, -34.5854102),
                    (-58.4808038, -34.5860826), (-58.4826414, -34.5874453), (-58.4847289, -34.5890026),
                    (-58.4846944, -34.5890614), (-58.4840805, -34.5885991), (-58.4818397, -34.5869531),
                    (-58.4804402, -34.5858716), (-58.4793643, -34.5850434), (-58.4771262, -34.5833689),
                    (-58.4746217, -34.5815049), (-58.4743723, -34.5813208), (-58.4741826, -34.5815823),
                    (-58.4739767, -34.581729), (-58.4735813, -34.5823586), (-58.4727582, -34.5839569),
                    (-58.4724753, -34.5845227), (-58.4721817, -34.5850862), (-58.4718719, -34.5855745),
                    (-58.4716107, -34.5860852), (-58.4713034, -34.5866694), (-58.4709489, -34.587399),
                    (-58.4708602, -34.5873243), (-58.4711094, -34.5868964), (-58.4713608, -34.586441),
                    (-58.4716365, -34.5858915), (-58.4718572, -34.585493), (-58.472104, -34.5850762),
                    (-58.4726942, -34.583921), (-58.4735292, -34.5822771), (-58.4738487, -34.581752),
                    (-58.4715957, -34.5824781), (-58.4680727, -34.5836136), (-58.466001, -34.5842971),
                    (-58.4634205, -34.5851504), (-58.4606296, -34.5852169), (-58.4605108, -34.5856503),
                    (-58.4614585, -34.5859553), (-58.4620119, -34.586238), (-58.4625231, -34.5865902),
                    (-58.4628628, -34.5870095), (-58.4636625, -34.587726), (-58.4647798, -34.5887718),
                    (-58.4658061, -34.5897509), (-58.4660739, -34.5899842), (-58.466288, -34.5902043),
                    (-58.4667223, -34.5905297), (-58.4666792, -34.5906371), (-58.4662285, -34.59025),
                    (-58.4656862, -34.5898231), (-58.4647135, -34.5888928), (-58.4635528, -34.5877994),
                    (-58.4627778, -34.5870734), (-58.4623657, -34.5866603), (-58.4619024, -34.5863109),
                    (-58.4613637, -34.5860173), (-58.4605113, -34.5857502), (-58.460358, -34.5857447),
                    (-58.4598936, -34.5856838), (-58.4593952, -34.5858441), (-58.4575608, -34.5865488),
                    (-58.4566006, -34.5870518), (-58.4554512, -34.5874503), (-58.4549587, -34.5875013),
                    (-58.4541034, -34.5877912), (-58.4516405, -34.5887778), (-58.4506224, -34.5890554),
                    (-58.44788, -34.5915963), (-58.4476267, -34.5914521), (-58.4503173, -34.588885),
                    (-58.4507202, -34.5888383), (-58.4516238, -34.5885456), (-58.4541224, -34.5876571),
                    (-58.4549705, -34.5873801), (-58.455407, -34.5873497), (-58.4565791, -34.5869144),
                    (-58.4574268, -34.5864409), (-58.4593368, -34.5857394), (-58.4599119, -34.5855742),
                    (-58.4603885, -34.5856156), (-58.4604726, -34.5852215), (-58.4576757, -34.5850918),
                    (-58.4560467, -34.5853337), (-58.4554061, -34.58553), (-58.4547121, -34.58578),
                    (-58.4548122, -34.585637), (-58.4555433, -34.5853774), (-58.4562737, -34.5851958),
                    (-58.4575432, -34.5850127), (-58.4592883, -34.5850572), (-58.460324, -34.5851006),
                    (-58.4604342, -34.5828301), (-58.4604345, -34.5817159), (-58.4604722, -34.5798297),
                    (-58.4604145, -34.5783269), (-58.4600729, -34.5783266), (-58.4600147, -34.5781696),
                    (-58.4598515, -34.5772387), (-58.4597866, -34.5767873), (-58.4597609, -34.5745676),
                    (-58.4596794, -34.5739552), (-58.4590556, -34.5725477), (-58.4581083, -34.5711467),
                    (-58.4575953, -34.5697297), (-58.4577688, -34.5696644), (-58.458352, -34.5710886),
                    (-58.4594617, -34.5728982), (-58.4599734, -34.5741821), (-58.4599714, -34.5752012),
                    (-58.459963, -34.5768837), (-58.4602006, -34.5782004), (-58.4606328, -34.5782233),
                    (-58.4606358, -34.5783257), (-58.4605956, -34.579825), (-58.4605636, -34.5817413),
                    (-58.4605643, -34.5826576), (-58.4605443, -34.5851174), (-58.4633988, -34.5850717),
                    (-58.4668798, -34.5839207), (-58.4690879, -34.5832033), (-58.4720518, -34.5822413),
                    (-58.4738544, -34.5816795), (-58.4740049, -34.5816027), (-58.4743296, -34.5812397),
                    (-58.4754138, -34.5799658), (-58.4755247, -34.5798938), (-58.4777764, -34.5793721),
                    (-58.4782887, -34.5792793)],
            "name": "Área CLV Av. Triunvirato (sureste)",
            "color": "rgba(0, 0, 255, 0.2)", # Color verde con 20% de opacidad
            "line_color": "rgba(0, 255, 0, 0.8)",  # Color verde con 80% de opacidad
        },

        {
            "coords": [(-58.4164043, -34.6279017), (-58.4163976, -34.6279602), (-58.4159845, -34.6279061),
                (-58.4159868, -34.6298863), (-58.4160355, -34.6319615), (-58.4161603, -34.6335948),
                (-58.416229, -34.6352765), (-58.4162435, -34.6366834), (-58.4162901, -34.6374235),
                (-58.4175349, -34.6383541), (-58.4186977, -34.6393382), (-58.419561, -34.6400708),
                (-58.4212641, -34.6414555), (-58.4225053, -34.6424449), (-58.4227847, -34.6426769),
                (-58.422796, -34.642847), (-58.4221961, -34.6423134), (-58.4205157, -34.6410042),
                (-58.4189813, -34.6397662), (-58.4176503, -34.6386186), (-58.4170308, -34.6380843),
                (-58.4162373, -34.6375401), (-58.4161471, -34.6372639), (-58.4161221, -34.6370072),
                (-58.4160864, -34.6361041), (-58.416051, -34.6345571), (-58.4160061, -34.6332948),
                (-58.415891, -34.6316531), (-58.4158488, -34.6299063), (-58.4158717, -34.6286639),
                (-58.4158786, -34.6278951), (-58.4145177, -34.6277947), (-58.4145534, -34.6277136),
                (-58.4146302, -34.6253202), (-58.4058005, -34.6242522), (-58.4058167, -34.6241509),
                (-58.4146414, -34.6252196), (-58.4147491, -34.6252293), (-58.4146642, -34.6277296),
                (-58.4158437, -34.6278322), (-58.4160053, -34.6278493), (-58.4164043, -34.6279017)],
            "name": "Área CLV Constitución (este)",
            "color": "rgba(45, 0, 80, 0.2)", # Color rojo con 20% de opacidad
            "line_color": "rgba(255, 0, 0, 0.8)"  # Color rojo con 80% de opacidad
        },

        {
            "coords": [
                (-58.3827908, -34.5970939), (-58.3827264, -34.5976503), (-58.3826221, -34.5990509),
                (-58.3843134, -34.5991065), (-58.3883699, -34.5993241), (-58.3915231, -34.599511),
                (-58.3944197, -34.5996328), (-58.3972279, -34.5996787), (-58.3989277, -34.5996813),
                (-58.402, -34.5993045), (-58.4045196, -34.5980003), (-58.4082125, -34.5980099),
                (-58.4127889, -34.5979262), (-58.4200592, -34.5977132), (-58.423351, -34.5975228),
                (-58.4233661, -34.5977367), (-58.4200768, -34.5978623), (-58.4126768, -34.5980456),
                (-58.4082792, -34.5981519), (-58.4045393, -34.5981445), (-58.4019395, -34.5994309),
                (-58.39875, -34.5998341), (-58.3968389, -34.5997864), (-58.3943765, -34.5997281),
                (-58.3915384, -34.5996158), (-58.3884322, -34.5994241), (-58.3856362, -34.5993372),
                (-58.3850338, -34.6026404), (-58.3837662, -34.6026407), (-58.3839561, -34.5992502),
                (-58.3826037, -34.5991886), (-58.3824094, -34.6023638), (-58.3822696, -34.6038288),
                (-58.3821596, -34.6041133), (-58.3823118, -34.6044295), (-58.3821862, -34.6061599),
                (-58.3821119, -34.6074292), (-58.3820275, -34.6090515), (-58.387233, -34.6093677),
                (-58.3873425, -34.6088835), (-58.3915223, -34.6091439), (-58.3915501, -34.6103049),
                (-58.387188, -34.6099792), (-58.3872374, -34.6094943), (-58.3820275, -34.6091518),
                (-58.3820263, -34.609411), (-58.3819217, -34.6116637), (-58.3818929, -34.6131452),
                (-58.3815969, -34.6174273), (-58.3816054, -34.6176033), (-58.3858207, -34.6177972),
                (-58.3890833, -34.6179362), (-58.3925195, -34.6181453), (-58.3955511, -34.6183102),
                (-58.3999193, -34.6185324), (-58.3999101, -34.6186487), (-58.3951496, -34.6183956),
                (-58.3890463, -34.6180631), (-58.3858121, -34.6179074), (-58.3815978, -34.6177439),
                (-58.3815312, -34.6222241), (-58.3813933, -34.6222128), (-58.3756696, -34.6221043),
                (-58.3741743, -34.6220639), (-58.3739749, -34.6219876), (-58.3685847, -34.6217766),
                (-58.3686555, -34.6216714), (-58.3740221, -34.6219025), (-58.3741918, -34.6219706),
                (-58.3756966, -34.6220046), (-58.3814155, -34.6221232), (-58.3814485, -34.6178045),
                (-58.3816532, -34.6131972), (-58.3768457, -34.6128791), (-58.3719987, -34.6125424),
                (-58.3696806, -34.6123887), (-58.3698408, -34.6122835), (-58.3736642, -34.6125147),
                (-58.3768448, -34.6127375), (-58.3773003, -34.6127462), (-58.3735974, -34.6092208),
                (-58.373087, -34.6090916), (-58.3707688, -34.6089563), (-58.3709612, -34.6077613),
                (-58.3735668, -34.6079762), (-58.3734887, -34.6088653), (-58.3777666, -34.6127903),
                (-58.3816709, -34.6130284), (-58.3817098, -34.6116735), (-58.3818762, -34.6094237),
                (-58.3819625, -34.6071973), (-58.3820606, -34.606133), (-58.3821421, -34.6044631),
                (-58.3819744, -34.6042036), (-58.3821782, -34.6035455), (-58.3806011, -34.6043501),
                (-58.3787021, -34.6053328), (-58.3762237, -34.6066514), (-58.3737561, -34.6077434),
                (-58.3760842, -34.606513), (-58.3786699, -34.6051234), (-58.3802899, -34.6042717),
                (-58.382146, -34.6032936), (-58.3821936, -34.6023952), (-58.3824058, -34.5991373),
                (-58.3825789, -34.5976304), (-58.3826191, -34.5970917), (-58.3827908, -34.5970939)
            ],
            "name": "Área CLV Cerrito (sur)",
            "color": "rgba(0, 0, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 0, 255, 0.8)"  # Color azul con 80% de opacidad
        },

        {
            "coords": [
                (-58.3808886, -34.6039659), (-58.3700094, -34.6032153), (-58.3706962, -34.5979343), 
                (-58.3733515, -34.5935009), (-58.3709429, -34.5906925), (-58.373362, -34.5892263), 
                (-58.3760522, -34.592715), (-58.3744199, -34.5936147), (-58.3736888, -34.5949384), 
                (-58.371756, -34.5983375), (-58.3709388, -34.6024783), (-58.3808244, -34.6030747), 
                (-58.3811141, -34.5985441), (-58.3814114, -34.5926678), (-58.3809217, -34.5924014), 
                (-58.3810007, -34.5897283), (-58.3796328, -34.5900683), (-58.3788442, -34.5892072), 
                (-58.380711, -34.5882246), (-58.3801102, -34.5874892), (-58.3816772, -34.586846), 
                (-58.3820413, -34.5876325), (-58.3840366, -34.5868953), (-58.3845943, -34.5874894), 
                (-58.3819871, -34.5889258), (-58.3817027, -34.5890346), (-58.3818261, -34.5895497), 
                (-58.382168, -34.592695), (-58.3818649, -34.5986323), (-58.3938489, -34.599206), 
                (-58.3936559, -34.6000891), (-58.3859527, -34.5995506), (-58.3857971, -34.6028931), 
                (-58.3838604, -34.602765), (-58.3817388, -34.6039792), (-58.3813552, -34.6075513), 
                (-58.3805774, -34.6075203), (-58.3808886, -34.6039659)
            ],
            "name": "Área CLV Av. 9 de Julio - Mitre",
            "color": "rgba(255, 0, 0, 0.2)",  # Color rojo con 20% de opacidad
            "line_color": "rgba(255, 0, 0, 0.8)"  # Color rojo con 80% de opacidad
        },

        {
            "coords": [
                (-58.3823553, -34.5925083), (-58.3807888, -34.5924641), (-58.3808317, -34.5898409), 
                (-58.3795228, -34.5902782), (-58.3787932, -34.589258), (-58.3807352, -34.5881627), 
                (-58.3795389, -34.5852744), (-58.3796664, -34.5841946), (-58.3800573, -34.5835752), 
                (-58.3805556, -34.5829734), (-58.3847449, -34.5806327), (-58.3871747, -34.5794512), 
                (-58.3890681, -34.5781107), (-58.3907953, -34.5768144), (-58.3914979, -34.5759145), 
                (-58.3922542, -34.5752089), (-58.3929287, -34.5748208), (-58.3936568, -34.5745298), 
                (-58.395313, -34.5741417), (-58.3960465, -34.5737005), (-58.3990169, -34.5721683), 
                (-58.4018585, -34.5704947), (-58.4047106, -34.5687592), (-58.4074018, -34.5669972), 
                (-58.410598, -34.5650988), (-58.4152085, -34.5628461), (-58.4168708, -34.5616114), 
                (-58.4177793, -34.5607529), (-58.4188487, -34.5599132), (-58.421176, -34.5582851), 
                (-58.4250033, -34.5556029), (-58.4286692, -34.5532446), (-58.4319138, -34.5515637), 
                (-58.4340792, -34.5503181), (-58.4376369, -34.548409), (-58.4413962, -34.5462174), 
                (-58.4453884, -34.5439772), (-58.4483553, -34.5422726), (-58.4495261, -34.5416344), 
                (-58.4515676, -34.5405624), (-58.4529363, -34.5400955), (-58.4541797, -34.5398153), 
                (-58.4566095, -34.538804), (-58.4585044, -34.5374642), (-58.4599438, -34.536073), 
                (-58.460481, -34.5361199), (-58.4591944, -34.5374924), (-58.456773, -34.5388994), 
                (-58.4542757, -34.5400022), (-58.4525049, -34.5404896), (-58.4516872, -34.5407422), 
                (-58.449854, -34.5417528), (-58.4491091, -34.5421362), (-58.4522654, -34.5462247), 
                (-58.4541273, -34.548453), (-58.453865, -34.5491083), (-58.4518169, -34.5463364), 
                (-58.4485594, -34.542477), (-58.4427717, -34.5457667), (-58.4389114, -34.5479317), 
                (-58.4351005, -34.550017), (-58.4321521, -34.5516953), (-58.4291503, -34.5533644), 
                (-58.4253398, -34.5557285), (-58.4214921, -34.5582928), (-58.4190615, -34.5600323), 
                (-58.4181585, -34.5607875), (-58.4172288, -34.5616615), (-58.4155075, -34.562992), 
                (-58.4134254, -34.5641782), (-58.411193, -34.5652584), (-58.4075608, -34.5673793), 
                (-58.4046981, -34.5691668), (-58.4032827, -34.5701135), (-58.4018245, -34.5709189), 
                (-58.3988059, -34.5726312), (-58.3955726, -34.574308), (-58.394046, -34.5746573), 
                (-58.3927125, -34.5752185), (-58.391749, -34.5760359), (-58.3911075, -34.5768599), 
                (-58.3894971, -34.5782451), (-58.3875862, -34.5795662), (-58.3839338, -34.5813702), 
                (-58.3807379, -34.5831545), (-58.3800124, -34.5839495), (-58.3798132, -34.5845766), 
                (-58.3797964, -34.5851861), (-58.3816795, -34.5883791), (-58.3976459, -34.5805495), 
                (-58.4011462, -34.5785686), (-58.404582, -34.5760576), (-58.4108522, -34.5715654), 
                (-58.4117954, -34.5723068), (-58.3983053, -34.5809732), (-58.3917485, -34.584067), 
                (-58.3916082, -34.584523), (-58.3917614, -34.5846779), (-58.3920713, -34.5846184), 
                (-58.3930514, -34.5843242), (-58.3947046, -34.5837715), (-58.3961933, -34.5832861), 
                (-58.3975566, -34.5829219), (-58.3997615, -34.5824952), (-58.4014339, -34.5819137), 
                (-58.4031583, -34.581404), (-58.4042787, -34.5807245), (-58.4061601, -34.5791832), 
                (-58.4067833, -34.5785881), (-58.4070169, -34.5784084), (-58.4076058, -34.5781242), 
                (-58.4137718, -34.5753986), (-58.4144765, -34.5749336), (-58.4147976, -34.5746186), 
                (-58.4151941, -34.5744434), (-58.4163983, -34.5739579), (-58.4171184, -34.5739184), 
                (-58.4153924, -34.5746562), (-58.4147538, -34.5750103), (-58.414044, -34.5754757), 
                (-58.4075998, -34.5783796), (-58.4070788, -34.5785997), (-58.4064409, -34.5791325), 
                (-58.4044044, -34.5807866), (-58.4033713, -34.5815024), (-58.401782, -34.5819896), 
                (-58.4000272, -34.5825601), (-58.3976213, -34.5830843), (-58.3962591, -34.5833703), 
                (-58.3951071, -34.5837813), (-58.3943456, -34.584003), (-58.3931498, -34.5844024), 
                (-58.3921163, -34.5847499), (-58.3919253, -34.5847754), (-58.3917542, -34.5848644), 
                (-58.391471, -34.5846891), (-58.3909476, -34.5844467), (-58.3864102, -34.5865389), 
                (-58.3819745, -34.5888914), (-58.3823553, -34.5925083)
            ],
            "name": "Área CLV Av. 9 de Julio - Juncal",
            "color": "rgba(0, 255, 0, 0.2)",  # Color verde con 20% de opacidad
            "line_color": "rgba(0, 255, 0, 0.8)"  # Color verde con 80% de opacidad
        },

        {
            "coords": [
                (-58.3860548, -34.6085562), (-58.3917412, -34.6090331), (-58.3916124, -34.6103577), 
                (-58.3870323, -34.6101461), (-58.3867867, -34.6096873), (-58.3823043, -34.6095112), 
                (-58.3818557, -34.6174408), (-58.3829529, -34.6175138), (-58.3920754, -34.6179398), 
                (-58.3919495, -34.618472), (-58.3818674, -34.6180151), (-58.3814928, -34.6220505), 
                (-58.381817, -34.6224845), (-58.3832998, -34.6226008), (-58.3901494, -34.6231509), 
                (-58.3898966, -34.6239484), (-58.3823672, -34.6233759), (-58.3822289, -34.627239), 
                (-58.3795014, -34.6273308), (-58.3788195, -34.6295475), (-58.3788243, -34.6321527), 
                (-58.3780825, -34.6343764), (-58.3775913, -34.6361196), (-58.377388, -34.6372594), 
                (-58.3770931, -34.6396099), (-58.3769678, -34.640996), (-58.3766064, -34.6424881), 
                (-58.3761698, -34.643424), (-58.375873, -34.6452556), (-58.3750296, -34.6473145), 
                (-58.3735474, -34.6500402), (-58.3726381, -34.6521355), (-58.3715733, -34.6550339), 
                (-58.3714254, -34.6547896), (-58.3723217, -34.6519674), (-58.3736423, -34.649306), 
                (-58.3747226, -34.6472022), (-58.3752244, -34.6459443), (-58.3755546, -34.6446511), 
                (-58.3760123, -34.6424534), (-58.3767553, -34.6388885), (-58.3770989, -34.6370397), 
                (-58.3776365, -34.6347732), (-58.3783707, -34.6322392), (-58.3781961, -34.6297479), 
                (-58.3789196, -34.6273519), (-58.3799448, -34.623748), (-58.3665921, -34.622566), 
                (-58.3642518, -34.62482), (-58.3600031, -34.6267611), (-58.3569668, -34.6286059), 
                (-58.3554567, -34.6298528), (-58.3545421, -34.6309499), (-58.3538521, -34.6331133), 
                (-58.3564467, -34.6342389), (-58.3549429, -34.6364767), (-58.3533801, -34.6352851), 
                (-58.3531906, -34.6342877), (-58.3531406, -34.6323635), (-58.3537133, -34.6305991), 
                (-58.3548478, -34.6292634), (-58.3567629, -34.6279788), (-58.3597884, -34.6260536), 
                (-58.3634359, -34.6241088), (-58.3650433, -34.6224027), (-58.3651625, -34.6214718), 
                (-58.3727917, -34.6217068), (-58.3806999, -34.6219767), (-58.3808541, -34.6175831), 
                (-58.3809654, -34.6154409), (-58.3809674, -34.6142903), (-58.3805188, -34.6131839), 
                (-58.37108, -34.6126253), (-58.3709633, -34.6138602), (-58.3688403, -34.6139295), 
                (-58.3690254, -34.6120287), (-58.3767569, -34.6126059), (-58.3733805, -34.6092831), 
                (-58.3695896, -34.6090698), (-58.3696418, -34.6085852), (-58.3719149, -34.6087276), 
                (-58.3738465, -34.6089654), (-58.3806971, -34.6094729), (-58.3807375, -34.6097796), 
                (-58.3739757, -34.6092209), (-58.3777748, -34.6126369), (-58.3810173, -34.6128464), 
                (-58.3813006, -34.6075521), (-58.3704666, -34.6066457), (-58.3704044, -34.6063925), 
                (-58.3813307, -34.6071845), (-58.3814209, -34.6059852), (-58.3815218, -34.60468), 
                (-58.3823855, -34.6047329), (-58.3821709, -34.6065696), (-58.3823855, -34.6082826), 
                (-58.3860548, -34.6085562)
            ],
            "name": "Área CLV Av. 9 de Julio - Av. Corrientes",
            "color": "rgba(0, 255, 0, 0.2)",  # Color verde con 20% de opacidad
            "line_color": "rgba(0, 255, 0, 0.8)"  # Color verde con 80% de opacidad
        },

        {
            "coords": [
                (-58.3929669, -34.5992211), (-58.3926772, -34.6001836), (-58.3862024, -34.5996405), 
                (-58.3857572, -34.6029654), (-58.3830213, -34.60278), (-58.3828725, -34.6080991), 
                (-58.3919605, -34.6089925), (-58.3916551, -34.6106932), (-58.3871035, -34.6104044), 
                (-58.3867589, -34.6098979), (-58.3824876, -34.6094709), (-58.3821254, -34.621972), 
                (-58.3821167, -34.6236474), (-58.3806179, -34.6242472), (-58.3791619, -34.6235051), 
                (-58.3747961, -34.6233262), (-58.3717842, -34.6228444), (-58.3650981, -34.622724), 
                (-58.3652527, -34.6212511), (-58.3664158, -34.6213675), (-58.3737719, -34.6218153), 
                (-58.3770285, -34.6219554), (-58.3806887, -34.622039), (-58.3808206, -34.6218266), 
                (-58.3816373, -34.604449), (-58.3766269, -34.6068686), (-58.381015, -34.6072042), 
                (-58.3809131, -34.6077297), (-58.3758222, -34.6073102), (-58.3738267, -34.6084229), 
                (-58.3735478, -34.6095532), (-58.3693099, -34.6093324), (-58.3697712, -34.6061445), 
                (-58.3753073, -34.6064802), (-58.3818091, -34.6031067), (-58.3821308, -34.5987441), 
                (-58.3929669, -34.5992211)
            ],
            "name": "Área CLV Av. 9 de Julio 842",
            "color": "rgba(0, 0, 255, 0.2)",  # Color azul con 20% de opacidad
            "line_color": "rgba(0, 0, 255, 0.8)"  # Color azul con 80% de opacidad
        },

        {
            "coords": [
                (-58.3808283, -34.6187125), (-58.3807908, -34.6188935), (-58.3804796, -34.6188626), 
                (-58.3805011, -34.6182049), (-58.380552, -34.6173661), (-58.3805809, -34.6156245), 
                (-58.3807007, -34.6140456), (-58.380677, -34.6131652), (-58.3780159, -34.6129724), 
                (-58.3751136, -34.6127918), (-58.3710377, -34.6125432), (-58.3708889, -34.6135939), 
                (-58.369238, -34.6136203), (-58.3691765, -34.6124016), (-58.369225, -34.612154), 
                (-58.3713606, -34.6122769), (-58.3751606, -34.6125391), (-58.3770958, -34.6126396), 
                (-58.3766545, -34.6121883), (-58.3753399, -34.6109033), (-58.374118, -34.6097564), 
                (-58.3732627, -34.609101), (-58.3718199, -34.6090653), (-58.370943, -34.6089383), 
                (-58.3712462, -34.6076104), (-58.372314, -34.607745), (-58.373629, -34.6079344), 
                (-58.3735769, -34.608918), (-58.3748381, -34.6100223), (-58.3759243, -34.6111017), 
                (-58.3770608, -34.6121166), (-58.3776615, -34.6126516), (-58.3805471, -34.6128605), 
                (-58.380654, -34.6126236), (-58.3808785, -34.6106662), (-58.3809239, -34.6091967), 
                (-58.380946, -34.6079904), (-58.3810374, -34.6060022), (-58.3811085, -34.6047854), 
                (-58.3809814, -34.6040441), (-58.380993, -34.6032672), (-58.3811783, -34.6026491), 
                (-58.3812926, -34.6014631), (-58.3814445, -34.5987645), (-58.3816757, -34.5964869), 
                (-58.3818595, -34.5950917), (-58.3818518, -34.5934601), (-58.3817346, -34.5926018), 
                (-58.3816192, -34.5899659), (-58.3811579, -34.5887295), (-58.3817267, -34.588553), 
                (-58.3820059, -34.5898252), (-58.3820786, -34.592556), (-58.3821767, -34.5936832), 
                (-58.3821077, -34.5956484), (-58.3818209, -34.5980069), (-58.3817252, -34.6011351), 
                (-58.3815571, -34.6025556), (-58.3813206, -34.603232), (-58.3814766, -34.6041859), 
                (-58.3815229, -34.6054231), (-58.3814506, -34.6078288), (-58.3813892, -34.6089837), 
                (-58.3856784, -34.6091634), (-58.387124, -34.6092415), (-58.3874154, -34.6088402), 
                (-58.3915372, -34.6090881), (-58.391455, -34.6102366), (-58.3873617, -34.610039), 
                (-58.3872006, -34.6095248), (-58.3856624, -34.6093862), (-58.381355, -34.6091851), 
                (-58.381141, -34.6106941), (-58.3810601, -34.6127353), (-58.3810396, -34.613733), 
                (-58.3808635, -34.6154512), (-58.3808243, -34.617291), (-58.3808623, -34.6174825), 
                (-58.3817665, -34.6174745), (-58.3818123, -34.6175636), (-58.3838108, -34.6176439), 
                (-58.3863298, -34.6177351), (-58.3882899, -34.6178285), (-58.3899896, -34.6179269), 
                (-58.391569, -34.6180159), (-58.3915594, -34.6182479), (-58.3911636, -34.6181931), 
                (-58.3883778, -34.6179837), (-58.3848147, -34.6178439), (-58.3837908, -34.6178231), 
                (-58.3827831, -34.6177671), (-58.3817324, -34.6177375), (-58.3814242, -34.6176809), 
                (-58.3807941, -34.6176597), (-58.3808176, -34.6182402), (-58.3808283, -34.6187125)
            ],
            "name": "Área CLV Av. 9 de Julio - C. Calvo",
            "color": "rgba(255, 0, 0, 0.2)",  # Color rojo con 20% de opacidad
            "line_color": "rgba(255, 0, 0, 0.8)"  # Color rojo con 80% de opacidad
        },

        {
            "coords": [
                (-58.4779226, -34.6896878), (-58.477649, -34.6898422), (-58.4716275, -34.6845614), 
                (-58.468896, -34.6822143), (-58.467482, -34.6809591), (-58.4663029, -34.6801793), 
                (-58.4661324, -34.6799994), (-58.4653209, -34.6791738), (-58.4647066, -34.6782418), 
                (-58.4632635, -34.6769095), (-58.4599699, -34.6743111), (-58.4586716, -34.6738015), 
                (-58.4584624, -34.673282), (-58.4580172, -34.6726743), (-58.4564648, -34.6711721), 
                (-58.4545385, -34.6693174), (-58.4536593, -34.6685473), (-58.4528816, -34.6681938), 
                (-58.4522849, -34.6678826), (-58.4519479, -34.6674011), (-58.4516491, -34.666599), 
                (-58.4512687, -34.6657985), (-58.4509268, -34.665563), (-58.4500581, -34.6652637), 
                (-58.449576, -34.6649533), (-58.4490671, -34.664612), (-58.4476674, -34.6637221), 
                (-58.4460729, -34.6623745), (-58.4441186, -34.6608176), (-58.4422352, -34.6593584), 
                (-58.4400022, -34.6575264), (-58.4378963, -34.6558659), (-58.4359375, -34.6544601), 
                (-58.4307995, -34.6504835), (-58.4281363, -34.6480595), (-58.4264248, -34.6462075), 
                (-58.4251746, -34.6449159), (-58.4243497, -34.6443023), (-58.4233254, -34.6433854), 
                (-58.4235028, -34.6433688), (-58.4249089, -34.6445007), (-58.4255659, -34.6450564), 
                (-58.4262254, -34.6457309), (-58.4286919, -34.6481598), (-58.4311118, -34.6503549), 
                (-58.4363284, -34.6544576), (-58.4385799, -34.6561647), (-58.4404084, -34.6575653), 
                (-58.4424655, -34.6593376), (-58.4442993, -34.6607962), (-58.4462379, -34.6623065), 
                (-58.4479198, -34.6636618), (-58.4492831, -34.6645824), (-58.4502516, -34.6651321), 
                (-58.451175, -34.6654953), (-58.4514783, -34.6658362), (-58.4518331, -34.6666265), 
                (-58.4521582, -34.667449), (-58.4523962, -34.667739), (-58.4530159, -34.6680696), 
                (-58.4537994, -34.6684302), (-58.4545516, -34.6690343), (-58.4556699, -34.6701452), 
                (-58.4577181, -34.6721096), (-58.4583202, -34.6725905), (-58.4586467, -34.6728883), 
                (-58.4589304, -34.6736626), (-58.459841, -34.6738876), (-58.4632996, -34.6767805), 
                (-58.4648668, -34.6781618), (-58.4660285, -34.6794944), (-58.4663023, -34.6798617), 
                (-58.4666566, -34.6801674), (-58.467314, -34.6806), (-58.4679071, -34.6810768), 
                (-58.4690021, -34.6821098), (-58.472308, -34.6846873), (-58.4779226, -34.6896878)
            ],
            "name": "Área del CLV Av. Fernández de la Cruz - Saladillo",
            "color": "rgba(0, 255, 0, 0.2)",  # Color verde con 20% de opacidad
            "line_color": "rgba(0, 255, 0, 0.8)"  # Color verde con 80% de opacidad
        },

        {
            "coords": [
                (-58.4230588, -34.6429864), (-58.4229676, -34.6430571), (-58.4205883, -34.6412156),
                (-58.41938, -34.6402551), (-58.4184164, -34.6394549), (-58.4171095, -34.6391776),
                (-58.4155833, -34.6389194), (-58.4141725, -34.6386657), (-58.4106266, -34.6380588),
                (-58.4077399, -34.6375844), (-58.4052743, -34.6371518), (-58.4021288, -34.6366056),
                (-58.400975, -34.6363885), (-58.400472, -34.6362901), (-58.3989528, -34.6359984),
                (-58.3989678, -34.6359451), (-58.4004785, -34.636227), (-58.4010067, -34.6363347),
                (-58.4021215, -34.6364875), (-58.4053326, -34.6370195), (-58.40827, -34.6375514),
                (-58.4111887, -34.6380634), (-58.4115362, -34.638059), (-58.4182147, -34.6392858),
                (-58.4172182, -34.6383678), (-58.4162861, -34.6377145), (-58.4154949, -34.637229),
                (-58.4140062, -34.6362967), (-58.4125123, -34.6354261), (-58.4103343, -34.6339496),
                (-58.4087075, -34.6327413), (-58.408042, -34.6322202), (-58.407472, -34.6316165),
                (-58.4064175, -34.6304934), (-58.4054485, -34.6293188), (-58.4053739, -34.6292227),
                (-58.4055138, -34.6292369), (-58.4063677, -34.6302674), (-58.4068651, -34.6307916),
                (-58.4077495, -34.6317323), (-58.4084923, -34.6324053), (-58.4093393, -34.6330139),
                (-58.4109043, -34.634188), (-58.4124291, -34.6352165), (-58.413962, -34.6361191),
                (-58.4155378, -34.6370747), (-58.4162124, -34.6375034), (-58.4173153, -34.638292),
                (-58.4184543, -34.6393064), (-58.4188125, -34.6395863), (-58.4192244, -34.6399479),
                (-58.4210825, -34.6414528), (-58.4230588, -34.6429864)
            ],
            "name": "Área del CLV Av. Fernández de la Cruz 850",
            "color": "rgba(255, 165, 0, 0.2)",  # Color naranja con 20% de opacidad
            "line_color": "rgba(255, 165, 0, 0.8)"  # Color naranja con 80% de opacidad
        },

        

        ]

    
    # Agregar los nuevos puntos
    new_points = [
        (-58.3791083, -34.5987634, "1. Av. Córdoba 854", "Av. Córdoba 854"),
        (-58.4023505, -34.5992602, "2. Av. Córdoba 2474", "Tipo C"),
        (-58.4331402, -34.5921276, "3. Av. Córdoba 4885", "Tipo: J"),
        (-58.4132079, -34.6155648, "1. Av. Belgrano 3355", "Tipo: A"),
        (-58.3940113, -34.6141468, "2. Av. Belgrano 1851", "Tipo A"),
        (-58.3834273, -34.6133078, "3. Av. Belgrano 1189", "Tipo A"),
        (-58.4002897, -34.6240287, "Alberti (Norte)", "Alberti - Av. San Juan - Tipo: J"),
        (-58.3655936, -34.6186459, "Av. Alicia Moreau de Justo (Norte)", "Av. Alicia Moreau de Justo - Peñaloza - Tipo: J"),
        (-58.426458, -34.6316018, "Av. Asamblea (este)", "Av. Asamblea 50 - Tipo: J"),
        (-58.379705, -34.6088726, "Av. de Mayo (oeste)", "Av. de Mayo 923 - Tipo: A"),
        (-58.528433, -34.6166423, "Av. Beiro (noreste)", "Av. Beiro 5614 - Tipo: A"),
        (-58.4056232, -34.6337195, "Av. Brasil (noreste)", "Av. Brasil 2980 - Tipo J"),
        (-58.4164942, -34.6280104, "Constitución 3628 (este)", "Tipo J"),
        (-58.382825, -34.5970498, "Cerrito 952(sur)", "Cerrito 952 - Tipo J"),
        (-58.5061397, -34.5718192, "Av. Constituyentes (sureste)", "Av. Constituyentes 6070 - Tipo A"),
        (-58.4677797, -34.6962442, "Av. Coronel Roca (noreste)", "Av. Coronel Roca - Montiel - Tipo: B"),
        (-58.4218855, -34.6086511, "Av. Díaz Vélez (este)", "Av. Díaz Velez 3954 - Tipo J"),
        (-58.4813966, -34.6423, "Av. Directorio (noreste)", "Av. Directorio - Av. Lacarra - Tipo J"),
        (-58.4212841, -34.5673494, "Av. Dorrego (suroeste)", "Av. Dorrego - Freyre - Tipo J"),
        (-58.3718134, -34.5932548, "Av. Eduardo Madero (sur)", "Av. Eduardo Madero - San Martín - Tipo J"),
        (-58.5224037, -34.65534, "Av. Emilio Castro (noreste)", "Av. Emilio Castro 7483  - Tipo J"),
        (-58.4054754, -34.6132144, "Av. Jujuy (sur)", "Av. Jujuy 255  - Tipo  J"),
        (-58.3731422, -34.5946694, "Av. Leandro N. Alem (sur)", "Av. Leandro N. Alem 1166 - Tipo A"),
        (-58.4903537, -34.5524168, "Av. Parque Goyeneche (sureste)", "Av. Parque Goyeneche 4336 - Tipo A"),
        (-58.3696992, -34.6132929, "Av. Paseo Colón (sur)", "Av. Paseo Colón - Venezuela - Tipo J"),
        (-58.4976185, -34.5539931, "Av. Ricardo Balbín (sureste)", "Av. Ricardo Balbín 4650 - Tipo B"),
        (-58.4337438, -34.6169803, "Av. Rivadavia (suroeste)", "Av. Rivadavia 4856 - Tipo A"),
        (-58.4161957, -34.6537779, "Av. Sáenz (norte)", "Av. Sáenz 1160 - Tipo C"),
        (-58.4783786, -34.5793903, "Av. Triunvirato (sureste)", "Av. Triunvirato 4076 - Tipo J"),
        (-58.4983505, -34.6722607, "Av. Eva Perón (noreste)", "Av. Eva Perón 7172 - Tipo A")
    ]

# Verificar visibilidad de CLV y agregar/quitar polígonos/puntos
    #legend_items = []
    if clv_visibility['visible']:
        # Agregar polígonos
        for polygon in polygons:
            alert_map.add_trace(go.Scattermapbox(
                lat=[coord[1] for coord in polygon["coords"]],
                lon=[coord[0] for coord in polygon["coords"]],
                mode='lines',
                fill='toself',
                fillcolor=polygon["color"],
                line=dict(color=polygon["line_color"], width=2),
                name=polygon["name"],
                showlegend=False
            ))
        #    legend_items.append(html.Li(polygon["name"], id={'type': 'legend-item', 'index': polygons.index(polygon)}))

    # Agregar puntos CLV
    alert_map.add_trace(go.Scattermapbox(
        lat=[point[1] for point in new_points],
        lon=[point[0] for point in new_points],
        mode='markers',
        marker=dict(size=12, color='orange', symbol='circle'),
        hoverinfo='none',
        showlegend=False
    ))
    alert_map.add_trace(go.Scattermapbox(
        lat=[point[1] for point in new_points],
        lon=[point[0] for point in new_points],
        mode='markers',
        marker=dict(size=10, color='grey', symbol='circle'),
        text=[f"{point[2]}<br>{point[3]}" for point in new_points],
        hoverinfo='text',
        name='CLV',
        showlegend=False
    ))

    # Actualizar el layout del mapa para quitar las leyendas integradas
    alert_map.update_layout(
        mapbox_style="open-street-map",
        height=600,
        margin=dict(l=0, r=0, t=50, b=0),
        showlegend=False,
        dragmode='pan',
        hovermode='closest'
    )
    
       # Crear un contenedor para el mapa y las leyendas usando un div con flexbox
    map_legend_container = html.Div([
        # Columna del mapa (70% del ancho)
        html.Div([
            dcc.Graph(
                id='alerts-map',
                figure=alert_map,
                style={'height': '600px'}
            )
        ], style={'width': '70%', 'display': 'inline-block', 'vertical-align': 'top'}),
        
        # Columna de leyendas (30% del ancho)
        html.Div([
            html.H4("Leyenda CLV", style={'margin-bottom': '10px'}),
            # Contenedor de leyendas que se muestra/oculta según clv_visibility
            html.Div([
                # Sección de polígonos
                html.Div([
                    html.H5("Áreas CLV", style={'margin-bottom': '5px'}),
                    html.Ul([
                        html.Li([
                            html.Span(
                                style={
                                    'display': 'inline-block',
                                    'width': '12px',
                                    'height': '12px',
                                    'background-color': 'rgba(255, 0, 0, 0.2)',
                                    'border': '1px solid rgba(255, 0, 0, 0.3)',
                                    'margin-right': '5px'
                                }
                            ),
                            polygon["name"]
                        ], style={'margin-bottom': '5px'}) 
                        for polygon in polygons
                    ], style={'list-style-type': 'none', 'padding-left': '0'})
                ]),
                
                # Sección de puntos
                html.Div([
                    html.H5("Puntos CLV", style={'margin-top': '15px', 'margin-bottom': '5px'}),
                    html.Ul([
                        html.Li([
                            html.Span(
                                style={
                                    'display': 'inline-block',
                                    'width': '12px',
                                    'height': '12px',
                                    'background-color': 'grey',
                                    'border-radius': '50%',
                                    'margin-right': '5px'
                                }
                            ),
                            point[2]  # Nombre del punto
                        ], style={'margin-bottom': '5px'})
                        for point in new_points
                    ], style={'list-style-type': 'none', 'padding-left': '0'})
                ])
            ], style={'display': 'block' if clv_visibility['visible'] else 'none'})
        ], style={
            'width': '30%', 
            'display': 'inline-block', 
            'vertical-align': 'top',
            'padding': '20px',
            'background-color': '#f8f9fa',
            'border-left': '1px solid #dee2e6',
            'height': '600px',
            'overflow-y': 'auto'
        })
    ], style={
        'display': 'flex',
        'width': '100%',
        'border': '1px solid #dee2e6',
        'border-radius': '4px',
        'margin-bottom': '20px'
    })

    # Crear la sección de alertas y atascos
    alerts_jams = html.Div([
        html.H3(f"Total de Alertas: {processed_data.get('alerts', 0)}"),
        html.H3(f"Total de Atascos: {processed_data.get('jams', 0)}")
    ])

    # Generar otras salidas
    alerts_by_type = update_alerts_by_type_figure(processed_data) if processed_data else go.Figure()
    event_details = create_event_details(processed_data) if processed_data else "No hay detalles de eventos"
    recent_events = create_recent_events(processed_data) if processed_data else "No hay eventos recientes"
    
    return alerts_jams, alerts_by_type, event_details, recent_events, processed_data, clv_visibility, map_legend_container


# Función para procesar los datos de Waze

def process_waze_data(raw_data):

    processed_data = {

        'alerts': 0,

        'jams': 0,

        'total_jam_length': 0,

        'alerts_by_type': {},

        'alert_details': defaultdict(list),

        'alert_coordinates': []

    }

    if 'alerts' in raw_data:

        processed_data['alerts'] = len(raw_data['alerts'])

        for alert in raw_data['alerts']:

            alert_type = alert.get('type', 'Unknown')

            subtype = alert.get('subtype', alert_type)

            

            alert_type = event_names.get(alert_type, alert_type)

            subtype = event_names.get(subtype, subtype)

            

            pubMillis = alert.get('pubMillis', 0)

            # Convertimos la fecha a la zona horaria de Buenos Aires

            date_obj = datetime.fromtimestamp(pubMillis / 1000.0, tz=pytz.UTC).astimezone(buenos_aires_tz)

            date_str = date_obj.strftime('%d/%m %H:%M')

            

            street = alert.get('street', 'Calle desconocida')

            nearest_intersection = alert.get('nearBy', 'Intersección desconocida')

            

            if subtype not in processed_data['alerts_by_type']:

                processed_data['alerts_by_type'][subtype] = 0

            processed_data['alerts_by_type'][subtype] += 1

            

            processed_data['alert_details'][subtype].append({

                'date': date_str,

                'date_obj': date_obj,

                'location': alert.get('location', {}),

                'street': street,

                'nearest_intersection': nearest_intersection

            })

            

            if 'location' in alert and 'x' in alert['location'] and 'y' in alert['location']:

                processed_data['alert_coordinates'].append({

                    'lat': alert['location']['y'],

                    'lon': alert['location']['x'],

                    'evento': subtype,

                    'street': street,

                    'nearest_intersection': nearest_intersection

                })

    

    if 'jams' in raw_data:

        processed_data['jams'] = len(raw_data['jams'])

        processed_data['total_jam_length'] = sum(jam.get('length', 0) for jam in raw_data['jams'])

    return processed_data





# Función para crear un minimapa

def create_minimap(lat, lon, street=None, nearest_intersection=None, evento=None, date=None):

    if lat is None or lon is None:

        fig = go.Figure()

        fig.update_layout(

            title="Ubicación no disponible",

            height=300,

            width=300,

            margin=dict(l=0, r=0, t=0, b=0)

        )

        return fig

    else:

        # Preparamos el texto que se mostrará en el hover

        hover_text = f'Evento: {evento}<br>'

        if street:

            hover_text += f'Calle: {street}<br>'

        if nearest_intersection:

            hover_text += f'Intersección más cercana: {nearest_intersection}<br>'

        if date:

            hover_text += f'Fecha: {date}'

        

        fig = go.Figure(go.Scattermapbox(

            lat=[lat],

            lon=[lon],

            mode='markers',

            marker=go.scattermapbox.Marker(size=15, color='red'),

            text=[hover_text],

            hoverinfo='text'

        ))

        

        fig.update_layout(

            mapbox=dict(

                style="open-street-map",

                center=dict(lat=lat, lon=lon),

                zoom=15

            ),

            showlegend=False,

            height=300,

            width=300,

            margin=dict(l=0, r=0, t=0, b=0)

        )

        return fig



# Función para crear los detalles del evento

def create_event_details(processed_data):

    event_columns = []

    priority_subtypes = [

        "Via cerrada",

        "Obras en la calzada",

        "Baches en el camino",

        "Falla de semáforo"

    ]

    

    def create_event_column(subtype, alerts, is_priority=False):

        sorted_alerts = sorted(alerts, key=lambda x: x['date_obj'], reverse=True)

        total_pages = math.ceil(len(sorted_alerts) / 10)

        

        alert_items = []

        for i, alert in enumerate(sorted_alerts[:10]):

                short_date = alert['date_obj'].astimezone(buenos_aires_tz).strftime('%d/%m %H:%M')

                alert_items.append(

                    html.Div([

                        html.Button(

                            f"{short_date} - {alert['street']}",

                            id={'type': 'alert-button', 'index': f"{subtype}-{i}"},

                            style={

                                'display': 'block',

                                'marginBottom': '5px',

                                'width': '100%',

                                'textAlign': 'left',

                                'overflow': 'hidden',

                                'textOverflow': 'ellipsis',

                                'whiteSpace': 'nowrap',

                                'borderRadius': '15px',  # Botones más redondeados

                                'fontFamily': '"Roboto", sans-serif',  # Fuente más moderna

                                'border': 'none',

                                'padding': '10px',

                                'backgroundColor': 'white',

                                'transition': 'background-color 0.3s'

                            }

                        ),

                        html.Div(id={'type': 'alert-minimap', 'index': f"{subtype}-{i}"}, style={'display': 'none'})

                    ])

                )

        

        pagination = html.Div([

            html.Button("Anterior", id={'type': 'prev-button', 'subtype': subtype}, disabled=True),

            html.Span(id={'type': 'page-display', 'subtype': subtype}, children="Página 1 de {}".format(total_pages)),

            html.Button("Siguiente", id={'type': 'next-button', 'subtype': subtype}, disabled=total_pages <= 1)

        ], style={'display': 'flex', 'justifyContent': 'space-between', 'alignItems': 'center', 'marginTop': '10px'})

        

        background_color = 'lightyellow' if is_priority else 'white'

        

        return html.Div([

            html.H3(subtype, style={'fontSize': '1rem', 'marginBottom': '5px'}),

            html.Div(alert_items, id={'type': 'alert-container', 'subtype': subtype}),

            pagination,

            dcc.Store(id={'type': 'page-store', 'subtype': subtype}, data={'current_page': 1, 'total_pages': total_pages})

        ], style={'width': '24%', 'margin': '0.5%', 'backgroundColor': background_color, 'padding': '10px', 'boxSizing': 'border-box', 'display': 'inline-block', 'verticalAlign': 'top'})



    # Primero, agregar las columnas prioritarias

    for subtype in priority_subtypes:

        if subtype in processed_data['alert_details']:

            event_columns.append(create_event_column(subtype, processed_data['alert_details'][subtype], is_priority=True))

    

    # Luego, agregar el resto de las columnas

    for subtype, alerts in processed_data['alert_details'].items():

        if subtype not in priority_subtypes:

            event_columns.append(create_event_column(subtype, alerts))

    

    return html.Div(event_columns, style={'display': 'flex', 'flexWrap': 'wrap', 'justifyContent': 'flex-start'})



# Callback para la paginación de eventos

@app.callback(
    [Output({'type': 'alert-container', 'subtype': dash.MATCH}, 'children'),
     Output({'type': 'page-display', 'subtype': dash.MATCH}, 'children'),
     Output({'type': 'prev-button', 'subtype': dash.MATCH}, 'disabled'),
     Output({'type': 'next-button', 'subtype': dash.MATCH}, 'disabled'),
     Output({'type': 'page-store', 'subtype': dash.MATCH}, 'data')],
    [Input({'type': 'prev-button', 'subtype': dash.MATCH}, 'n_clicks'),
     Input({'type': 'next-button', 'subtype': dash.MATCH}, 'n_clicks')],
    [State({'type': 'page-store', 'subtype': dash.MATCH}, 'data'),
     State({'type': 'prev-button', 'subtype': dash.MATCH}, 'id'),
     State('processed-data-store', 'data'),
     State({'type': 'alert-container', 'subtype': dash.MATCH}, 'children')]
)
def update_page(prev_clicks, next_clicks, page_data, button_id, processed_data, current_children):
    ctx = dash.callback_context
    if not ctx.triggered:
        return dash.no_update, dash.no_update, dash.no_update, dash.no_update, dash.no_update
    
    button_id = ctx.triggered[0]['prop_id'].split('.')[0]
    action = eval(button_id)['type']
    subtype = eval(button_id)['subtype']
    
    current_page = page_data['current_page']
    total_pages = page_data['total_pages']
    
    if action == 'prev-button' and current_page > 1:
        current_page -= 1
    elif action == 'next-button' and current_page < total_pages:
        current_page += 1
    
    if processed_data and 'alert_details' in processed_data:
        if subtype in processed_data['alert_details']:
            sorted_alerts = sorted(processed_data['alert_details'][subtype], key=lambda x: x['date_obj'], reverse=True)
            start = (current_page - 1) * 10
            end = start + 10
            page_alerts = sorted_alerts[start:end]
            
            alert_items = []
            for i, alert in enumerate(page_alerts):
                # Buscar el estilo existente del botón si existe
                existing_style = {}
                for child in current_children:
                    if child['props']['children'][0]['props']['id']['index'] == f"{subtype}-{start+i}":
                        existing_style = child['props']['children'][0]['props']['style']
                        break
                
                alert_items.append(
                    html.Div([
                        html.Button(
                            f"{alert['date']} - {alert['street']}",
                            id={'type': 'alert-button', 'index': f"{subtype}-{start+i}"},
                            style=existing_style or {
                                'display': 'block',
                                'marginBottom': '5px',
                                'width': '100%',
                                'textAlign': 'left',
                                'overflow': 'hidden',
                                'textOverflow': 'ellipsis',
                                'whiteSpace': 'nowrap',
                                'borderRadius': '15px',
                                'fontFamily': '"Roboto", sans-serif',
                                'border': 'none',
                                'padding': '10px',
                                'transition': 'background-color 0.3s'
                            }
                        ),
                        html.Div(id={'type': 'alert-minimap', 'index': f"{subtype}-{start+i}"}, style={'display': 'none'})
                    ])
                )
            
            page_display = f"Página {current_page} de {total_pages}"
            prev_disabled = current_page == 1
            next_disabled = current_page == total_pages
            
            return alert_items, page_display, prev_disabled, next_disabled, {'current_page': current_page, 'total_pages': total_pages}
    
    return [], f"Página {current_page} de {total_pages}", True, True, page_data


# Callback para alternar la visibilidad de los minimapas de alertas
@app.callback(
    [Output({'type': 'alert-minimap', 'index': dash.MATCH}, 'children'),
     Output({'type': 'alert-minimap', 'index': dash.MATCH}, 'style'),
     Output({'type': 'alert-button', 'index': dash.MATCH}, 'style')],
    [Input({'type': 'alert-button', 'index': dash.MATCH}, 'n_clicks')],
    [State({'type': 'alert-minimap', 'index': dash.MATCH}, 'style'),
     State({'type': 'alert-button', 'index': dash.MATCH}, 'id'),
     State({'type': 'alert-button', 'index': dash.MATCH}, 'style'),
     State('processed-data-store', 'data')]
)
def toggle_minimap(n_clicks, current_style, button_id, current_button_style, processed_data):
    if n_clicks is None:
        return dash.no_update, dash.no_update, dash.no_update

    subtype, index = button_id['index'].split('-')
    index = int(index)

    if processed_data and 'alert_details' in processed_data:
        if subtype in processed_data['alert_details']:
            sorted_alerts = sorted(processed_data['alert_details'][subtype], key=lambda x: x['date_obj'], reverse=True)
            if index < len(sorted_alerts):
                alert = sorted_alerts[index]
                lat, lon = extract_coordinates(alert['location'])
                street = alert['street']
                nearest_intersection = alert.get('nearest_intersection', 'No disponible')
                date = alert['date']
                minimap = dcc.Graph(figure=create_minimap(lat, lon, street, nearest_intersection, subtype, date), style={'height': '200px', 'width': '100%'})

                new_style = {'display': 'block'} if current_style.get('display') == 'none' else {'display': 'none'}
                
                # Actualizar el estilo del botón
                new_button_style = dict(current_button_style)
                new_button_style['backgroundColor'] = 'lightblue'

                return minimap, new_style, new_button_style

    return "No se pudo cargar el mapa", {'display': 'none'}, current_button_style


# Callback para alternar la visibilidad de los minimapas de eventos recientes

@app.callback(

    [Output({'type': 'recent-event-minimap', 'index': dash.MATCH}, 'children'),

     Output({'type': 'recent-event-minimap', 'index': dash.MATCH}, 'style'),

     Output({'type': 'recent-event-button', 'index': dash.MATCH}, 'style')],  # Nuevo output para el estilo del botón

    [Input({'type': 'recent-event-button', 'index': dash.MATCH}, 'n_clicks')],

    [State({'type': 'recent-event-minimap', 'index': dash.MATCH}, 'style'),

     State({'type': 'recent-event-button', 'index': dash.MATCH}, 'id'),

     State('processed-data-store', 'data')]

)

def toggle_recent_event_minimap(n_clicks, current_style, button_id, processed_data):

    if n_clicks is None:

        return dash.no_update, dash.no_update, dash.no_update

    

    index = button_id['index']

    button_index = f"recent-event-{index}"

    

    script = f"""

    localStorage.setItem('{button_index}', 'clicked');

    """

    

    button_style = {

        'display': 'block',

        'marginBottom': '5px',

        'width': '100%',

        'textAlign': 'left',

        'overflow': 'hidden',

        'textOverflow': 'ellipsis',

        'whiteSpace': 'nowrap',

        'borderRadius': '15px',

        'fontFamily': '"Roboto", sans-serif',

        'border': 'none',

        'padding': '10px',

        'backgroundColor': 'lightblue',

        'transition': 'background-color 0.3s'

    }

    

    all_events = []

    for subtype, alerts in processed_data['alert_details'].items():

        for alert in alerts:

            all_events.append({**alert, 'subtype': subtype})

    

    sorted_events = sorted(all_events, key=lambda x: x['date_obj'], reverse=True)[:15]

    

    if int(index) < len(sorted_events):

        event = sorted_events[int(index)]

        lat, lon = extract_coordinates(event['location'])

        street = event['street']

        nearest_intersection = event.get('nearest_intersection', 'No disponible')

        date = event['date']

        minimap = dcc.Graph(figure=create_minimap(lat, lon, street, nearest_intersection, event['subtype'], date), style={'height': '200px', 'width': '100%'})

        

        new_style = {'display': 'block'} if current_style.get('display') == 'none' else {'display': 'none'}

        return minimap, new_style, button_style

    

    return "No se pudo cargar el mapa", {'display': 'none'}, button_style



# Callback para aislar el clic en la leyenda del mapa de alertas

#@app.callback(

    #Output('alerts-map', 'figure'),

   # [Input('alerts-map', 'clickData')],

   # [State('processed-data-store', 'data')]



def isolate_legend_click(clickData, processed_data):

    if not clickData:

        return dash.no_update

    

    selected_event = clickData['points'][0]['curveNumber']

    

    df = pd.DataFrame(processed_data['alert_coordinates'])

    

    filtered_df = df[df['evento'] == selected_event]

    

    if not filtered_df.empty:

        center_lat = filtered_df['lat'].mean()

        center_lon = filtered_df['lon'].mean()

    

    alert_map = px.scatter_mapbox(filtered_df, 

                                  lat="lat", 

                                  lon="lon", 

                                  color="evento",  

                                  hover_name="street",

                                  hover_data={

                                      "nearest_intersection": False,

                                      "evento": True,

                                      "lat": False,

                                      "lon": False

                                  },

                                  labels={"nearest_intersection": "Intersección más cercana", "evento": "Evento"},

                                  zoom=12,

                                  center=dict(lat=center_lat, lon=center_lon),

                                  title="Mapa de Alertas")

    alert_map.update_traces(marker=dict(size=15))

    alert_map.update_layout(

        mapbox_style="open-street-map",

        height=600,

        margin=dict(l=0, r=0, t=50, b=0),

        legend=dict(

            orientation="h",

            yanchor="bottom",

            y=-0.1,

            xanchor="center",

            x=0.5

        ),

        dragmode='pan',

        hovermode='closest'

    )



    return alert_map



# Función para extraer coordenadas de la ubicación

def extract_coordinates(location):

    if isinstance(location, dict):

        lon = location.get('x', None)

        lat = location.get('y', None)

        if lon is not None and lat is not None:

            return lat, lon

    elif isinstance(location, str):

        try:

            parts = location.split(', ')

            lat_part = parts[0].split(': ')[1]

            lon_part = parts[1].split(': ')[1]

            return float(lat_part), float(lon_part)

        except (IndexError, ValueError):

            print(f"Error al procesar la cadena de ubicación: {location}")

    print(f"Formato de location no esperado o coordenadas no disponibles: {location}")

    return None, None



# Función para crear eventos recientes

def create_recent_events(processed_data):

    all_events = []

    for subtype, alerts in processed_data['alert_details'].items():

        for alert in alerts:

            all_events.append({**alert, 'subtype': subtype})

    

    sorted_events = sorted(all_events, key=lambda x: x['date_obj'], reverse=True)[:15]

    

    event_items = []

    for i, event in enumerate(sorted_events):

        # Aseguramos que la fecha esté en la zona horaria de Buenos Aires

        short_date = event['date_obj'].astimezone(buenos_aires_tz).strftime('%d/%m %H:%M')

        event_items.append(

            html.Div([

                html.Button(

                    f"{event['subtype']} - {short_date} - {event['street']}",

                    id={'type': 'recent-event-button', 'index': i},

                    style={

                        'display': 'block',

                        'marginBottom': '5px',

                        'width': '100%',

                        'textAlign': 'left',

                        'overflow': 'hidden',

                        'textOverflow': 'ellipsis',

                        'whiteSpace': 'nowrap',

                        'borderRadius': '15px',

                        'fontFamily': '"Roboto", sans-serif',

                        'border': 'none',

                        'padding': '10px',

                        'backgroundColor': 'white',

                        'transition': 'background-color 0.3s'

                    }

                ),

                html.Div(id={'type': 'recent-event-minimap', 'index': i}, style={'display': 'none'})

            ])

        )

    

    return event_items



if 'DYNO' in os.environ:

    app.scripts.append_script({

        'external_url': 'https://cdn.jsdelivr.net/npm/vega@5.20.2/build/vega.min.js'

    })

    app.css.append_css({

        'external_url': 'https://cdn.jsdelivr.net/npm/vega@5.20.2/build/vega.min.css'

    })



if __name__ == '__main__':

    app.run_server(debug=True, host='0.0.0.0', port=int(os.environ.get("PORT", 8080)))